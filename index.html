<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Family Meeting Hub</title>
    <style>
        :root {
            --glass-bg: rgba(255, 255, 255, 0.25);
            --glass-border: rgba(255, 255, 255, 0.18);
            --text-primary: #2d3748;
            --text-secondary: #4a5568;
            --shadow-light: 0 8px 32px rgba(31, 38, 135, 0.37);
            --button-disabled-bg: #ccc;
            --progress-glow-color: #38bdf8;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            min-height: 100vh;
            color: var(--text-primary);
            transition: background 0.5s ease, color 0.3s ease;
            overflow-x: hidden;
            /* Default Theme */
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        /* --- MULTIPLE THEMES --- */
        body.dark-theme {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            --glass-bg: rgba(0, 0, 0, 0.25);
            --glass-border: rgba(255, 255, 255, 0.1);
            --text-primary: #f7fafc;
            --text-secondary: #e2e8f0;
            --button-disabled-bg: #555;
            --progress-glow-color: #f59e0b;
        }
        body.ocean-theme {
            background: linear-gradient(135deg, #2E3192 0%, #1BFFFF 100%);
        }
        body.sunset-theme {
            background: linear-gradient(135deg, #FF512F 0%, #F09819 100%);
        }
        body.forest-theme {
            background: linear-gradient(135deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
        }
        body.sunrise-theme {
            background: linear-gradient(135deg, #F3904F 0%, #3B4371 100%);
        }
        body.mint-theme {
            background: linear-gradient(135deg, #76b852 0%, #8DC26F 100%);
        }
        body.royal-theme {
            background: linear-gradient(135deg, #4743ff 0%, #c33a9f 100%);
        }


        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 2;
        }

        .header {
            text-align: center;
            padding: 2rem 1rem;
            margin-bottom: 2rem;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            box-shadow: var(--shadow-light);
            backdrop-filter: blur(10px);
        }

        .header h1 { font-size: 2.5rem; margin-bottom: 0.5rem; }
        .header p { font-size: 1.2rem; opacity: 0.9; min-height: 1.5rem; }

        .controls {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .control-btn {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            color: var(--text-primary);
            padding: 12px 24px;
            border-radius: 30px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .control-btn:hover { transform: translateY(-3px); box-shadow: 0 4px 15px rgba(0,0,0,0.1); }

        .meeting-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 28px;
        }

        .meeting-box {
            background: var(--glass-bg);
            border: 2px solid transparent;
            border-radius: 20px;
            padding: 25px;
            box-shadow: var(--shadow-light);
            backdrop-filter: blur(10px);
            display: flex;
            flex-direction: column;
            transition: border-color 0.4s ease, box-shadow 0.4s ease;
        }
        
        .card-used {
            border-color: var(--progress-glow-color);
            box-shadow: 0 0 15px var(--progress-glow-color);
        }

        .meeting-box h2 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .content { 
            flex-grow: 1; 
            margin-bottom: 1rem; 
            line-height: 1.6; 
            font-weight: bold;
        }
        .content ul { list-style-position: inside; padding-left: 10px; font-weight: normal; }
        .content p, .content ul { margin-bottom: 10px; }
        .content h3 { margin-bottom: 10px; font-size: 1.2rem; color: var(--text-primary); }
        .content blockquote { font-style: italic; padding-left: 15px; border-left: 3px solid var(--text-secondary); margin-left: 0; opacity: 0.9; }
        
        /* Style for the attribution link */
        .quote-attribution { 
            font-size: 0.8rem; 
            font-style: normal;
            font-weight: normal; 
            margin-top: 10px; 
            text-align: right; 
            opacity: 0.7;
        }
        .quote-attribution a { color: var(--text-secondary); text-decoration: none; }
        .quote-attribution a:hover { text-decoration: underline; }

        .random-btn {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 0.95rem;
            align-self: flex-start;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            font-weight: bold;
        }
        
        .random-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        .random-btn:disabled { background: var(--button-disabled-bg); cursor: not-allowed; opacity: 0.7; }
        .notes-area { width: 100%; min-height: 100px; padding: 10px; border-radius: 10px; border: 1px solid var(--glass-border); background-color: var(--glass-bg); color: var(--text-primary); font-family: inherit; font-weight: normal; }

        /* MODAL STYLES */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.6);
            backdrop-filter: blur(5px);
            animation: fadeIn 0.3s ease;
        }
        .modal-content {
            background: rgba(255, 255, 255, 0.95);
            color: #2d3748;
            margin: 10% auto;
            padding: 30px;
            border-radius: 20px;
            max-width: 600px;
            width: 90%;
            position: relative;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        .dark-theme .modal-content,
        .forest-theme .modal-content,
        .royal-theme .modal-content,
        .sunrise-theme .modal-content { 
            background: rgba(30, 41, 59, 0.95); 
            color: #f7fafc; 
        }
        .modal-close { position: absolute; top: 15px; right: 25px; font-size: 2rem; font-weight: bold; cursor: pointer; transition: transform 0.2s ease; }
        .modal-close:hover { transform: scale(1.2); }
        .modal-content h2 { margin-bottom: 1rem; }
        .modal-content ul, .modal-content ol { padding-left: 25px; }

        @keyframes fadeIn { from {opacity: 0;} to {opacity: 1;} }
    </style>
</head>
<body>

    <div class="container">
        <header class="header">
            <h1 id="main-title">‚ú® Family Meeting Hub</h1>
            <p id="subtitle"></p>
        </header>

        <div class="controls">
            <button class="control-btn" onclick="showHelpModal()">‚ùì How to Use</button>
            <button class="control-btn" onclick="showRulesModal()">üìú Meeting Rules</button>
            <button class="control-btn" id="startBtn" onclick="startMeeting()">üöÄ New Meeting</button>
            <button class="control-btn" onclick="changeTheme()">üé® Change Theme</button>
        </div>

        <div class="meeting-grid">
            <div class="meeting-box" id="card-iceBreaker"><h2>üéØ Ice Breaker</h2><div class="content" id="iceBreaker"><p>Let's get the conversation flowing!</p></div><button class="random-btn" onclick="generateIceBreaker(this)">Get Question</button></div>
            <div class="meeting-box" id="card-famousQuote"><h2>üí¨ Inspiring Quote</h2><div class="content" id="famousQuote"><blockquote>An inspiring quote will appear here...</blockquote></div><button class="random-btn" onclick="generateQuote(this)">Get Quote</button></div>
            <div class="meeting-box" id="card-checkIn"><h2>üíñ Check-In</h2><div class="content"><p>Go around and share using the **Rose, Bud, Thorn** format:</p><ul><li><strong>üåπ Rose:</strong> A highlight or positive moment.</li><li><strong>üå± Bud:</strong> Something you're looking forward to.</li><li><strong>üåµ Thorn:</strong> A challenge you faced.</li></ul></div></div>
            <div class="meeting-box" id="card-interestingFact"><h2>üí° Amazing Fact</h2><div class="content" id="interestingFact"><p>Ready to discover something incredible?</p></div><button class="random-btn" onclick="generateFact(this)">Discover Fact</button></div>
            <div class="meeting-box" id="card-moralStory"><h2>üìñ Story Time</h2><div class="content" id="moralStory"><p>A meaningful story to share...</p></div><button class="random-btn" onclick="generateStory(this)">Tell Story</button></div>
            <div class="meeting-box" id="card-lifeSkill"><h2>üõ†Ô∏è Life Skill</h2><div class="content" id="lifeSkill"><p>Learn a valuable skill together!</p></div><button class="random-btn" onclick="generateSkill(this)">Learn Skill</button></div>
            <div class="meeting-box" id="card-jokeContent"><h2>üòÇ Joke Time</h2><div class="content" id="jokeContent"><p>Ready for a laugh?</p></div><button class="random-btn" onclick="generateJoke(this)">Tell Joke</button></div>
            <div class="meeting-box" id="card-upcoming"><h2>üóìÔ∏è Upcoming Events</h2><div class="content"><p>Let's look at the week ahead...</p></div></div>
            <div class="meeting-box" id="card-notes"><h2>üìù Meeting Notes</h2><div class="content"><p>Capture important moments:</p><textarea class="notes-area" id="meetingNotes" placeholder="Write down key points..."></textarea><div style="margin-top: 16px;"><button class="random-btn" onclick="exportNotes()">üìÑ Export Notes</button></div></div></div>
        </div>
    </div>
    
    <div id="helpModal" class="modal"><div class="modal-content"><span class="modal-close" onclick="closeHelpModal()">&times;</span><h2>How to Use This Tool</h2><ol><li><strong>Set the Stage:</strong> Use the "Meeting Rules" button to review the ground rules for a great meeting.</li><li><strong>Start a "New Meeting":</strong> Click this to reset all the cards and progress indicators for a fresh start.</li><li><strong>Follow the Flow:</strong> The cards are in a suggested order. Start with an "Ice Breaker" to warm up, an "Inspiring Quote" to set the tone, and then the "Check-In."</li><li><strong>Generate Content:</strong> Click the button on any card to get a random prompt. The card will glow to show it's been used in this session.</li><li><strong>Discuss:</strong> Use the prompts to spark meaningful conversations.</li><li><strong>Take Notes:</strong> Use the "Meeting Notes" card to capture anything important. You can export these notes as a text file when you're done.</li></ol></div></div>
    <div id="rulesModal" class="modal"><div class="modal-content"><span class="modal-close" onclick="closeRulesModal()">&times;</span><h2>Suggested Meeting Rules</h2><ul><li><strong>Be Present:</strong> Put away phones and other distractions. Let's give each other our full attention.</li><li><strong>One Speaker at a Time:</strong> Everyone gets a chance to speak without being interrupted.</li><li><strong>Listen to Understand:</strong> Don't just wait for your turn to talk. Truly listen to what others are saying and feeling.</li><li><strong>Be Respectful:</strong> It's okay to disagree, but we must be kind and respectful in how we express ourselves. No name-calling or yelling.</li><li><strong>Everyone Participates:</strong> Every voice matters! Let's make sure everyone, from the oldest to the youngest, has a chance to share.</li><li><strong>Focus on Solutions:</strong> When discussing challenges, let's work together to find solutions, not just dwell on problems.</li></ul></div></div>

<script>
    // --- API and Content Data ---
    const API_URLS = { 
        fact: 'https://uselessfacts.jsph.pl/random.json?language=en', 
        // NOTE: Switched to ZenQuotes. Using a CORS proxy to prevent browser errors.
        quote: 'https://cors-anywhere.herokuapp.com/https://zenquotes.io/api/random', 
        joke: 'https://official-joke-api.appspot.com/random_joke' 
    };
    const subtitles = [ "Time to connect and share.", "Let's make today's meeting great.", "Your weekly huddle starts now.", "A moment to grow together.", "Discover something new about your family." ];
    const themes = ['', 'dark-theme', 'ocean-theme', 'sunset-theme', 'forest-theme', 'sunrise-theme', 'mint-theme', 'royal-theme'];
    let currentThemeIndex = 0;
    
    // (Content arrays for icebreakers, stories, and skills are omitted for brevity but are unchanged)
    const allIceBreakers = ["If you could have any superpower, what would it be and why?", "What's one thing you're grateful for today?", "If you could talk to animals, which animal would you ask for advice?", "What's the best thing that happened to you this week?", "If you could invent a new holiday, what would it be and how would we celebrate?", "What's a small thing that always makes you smile?", "If you could have any fictional character as a best friend, who would you choose?", "What's your favorite smell and what memory does it bring up?", "If you could only eat one food for the rest of your life, what would it be?", "What's a skill you'd like to learn?", "If you were a flavor of ice cream, what would you be?", "What book, movie, or TV show have you seen recently that you'd recommend?", "What's one place you'd love to travel to?", "If you could ask your future self one question, what would it be?", "What's a simple act of kindness you witnessed or did this week?", "If you could be famous for one thing, what would it be?", "What's your favorite thing about our family?", "If you could solve one world problem, what would it be?", "What's a song that always puts you in a good mood?", "What's something you're looking forward to?", "If you had to describe your day with a movie title, what would it be?", "What's the weirdest dream you've ever had?", "If you could bring one extinct animal back to life, which would it be?", "What's something you've accomplished that you're proud of?", "If you could have dinner with any three people, living or dead, who would they be?", "What's a word that you think is really fun to say?", "What's your favorite season and why?", "If you had to create a new rule for our family for a day, what would it be?", "What's the best advice you've ever received?", "If you could instantly become an expert in something, what would it be?", "What's a tradition you'd like to start as a family?", "If you had a personal robot, what would you have it do?", "What's something that you find beautiful in nature?", "What's a challenge you've overcome?", "If you could visit any time period, past or future, when would you go?", "What's the funniest joke you know?", "What's something you did this week to help someone else?", "If you could design a new toy, what would it be?", "What makes a good friend?", "What's your favorite family memory?", "If you had to give up either music or movies for a year, which would you choose?", "What's a food you used to dislike but now you love?", "What's something you want to get better at?", "If you could have any wild animal as a pet, what would it be?", "What's a goal you have for yourself for this month?", "If you were a superhero, what would your name be?", "What's the most interesting thing you've learned recently?", "If you could trade places with a family member for a day, who would it be?", "What's your favorite way to relax?", "If you could create a new flavor of potato chip, what would it be?", "What's a simple pleasure you enjoyed this week?", "If our family was a band, what instrument would each person play?", "What's something you're curious about right now?", "What's a food that you think is underrated?"];
    const allStories = [ { title: "The Lion and the Mouse", story: "A lion was about to eat a mouse, who pleaded for his life. The lion let him go. Later, the lion was trapped in a net. The mouse gnawed the ropes, freeing him. Moral: An act of kindness, no matter how small, is never wasted." }, { title: "The Tortoise and the Hare", story: "A hare boasted about his speed and challenged a tortoise to a race. The hare, far ahead, took a nap. The tortoise kept moving slowly but steadily and crossed the finish line first. Moral: Slow and steady wins the race." }, { title: "The Boy Who Cried Wolf", story: "A shepherd boy repeatedly tricked villagers into thinking a wolf was attacking his flock. When a real wolf appeared, no one believed his cries for help, and the sheep were scattered. Moral: Liars are not believed even when they speak the truth." }, { title: "The Ant and the Grasshopper", story: "All summer, an ant worked hard to store food for winter. A grasshopper sang and played. When winter came, the ant was prepared, but the grasshopper was hungry. Moral: It is wise to prepare for the days of necessity." }, { title: "King Midas and the Golden Touch", story: "A king wished that everything he touched would turn to gold. He soon discovered he couldn't eat or drink. When he hugged his daughter, she turned to gold, and he was heartbroken. Moral: Greed can lead to your downfall; the best things in life are not material." }, { title: "The Bundle of Sticks", story: "A father asked his sons, who were always arguing, to break a bundle of sticks. They couldn't. Then he gave them one stick each, which they broke easily. Moral: There is strength in unity." }, { title: "The Wind and the Sun", story: "The Wind and the Sun argued about who was stronger. They decided to see who could make a traveler take off his cloak. The Wind blew fiercely, but the traveler only held his cloak tighter. The Sun shone gently, and the traveler, feeling the warmth, took off his cloak. Moral: Persuasion is better than force." }, { title: "The Honest Woodcutter", story: "A woodcutter dropped his axe in a river. The god Mercury appeared and offered him a golden axe, then a silver one. The man was honest and said they weren't his. Pleased, Mercury gave him all three axes. Moral: Honesty is the best policy." }, { title: "The Crow and the Pitcher", story: "A thirsty crow found a pitcher with water at the bottom, but he couldn't reach it. He dropped pebbles into the pitcher one by one until the water level rose high enough for him to drink. Moral: Little by little does the trick; persistence and cleverness can solve difficult problems." }, { title: "The City Mouse and the Country Mouse", story: "A city mouse visited his country cousin and mocked his simple food. He invited him to the city for a feast, but their meal was interrupted by dogs, and they had to run for their lives. Moral: Peace and safety with a little is better than luxury with fear." }, { title: "The Dog and Its Reflection", story: "A dog with a piece of meat in his mouth saw his reflection in the water. Thinking it was another dog with a bigger piece, he barked to snatch it, dropping his own meat into the water and losing it. Moral: Be content with what you have; greed can lead to loss." }, { title: "The Two Goats on the Bridge", story: "Two goats met in the middle of a narrow bridge over a river. Neither would give way. They locked horns and fought until both fell into the river below. Moral: It is better to yield than to come to ruin through stubbornness." }, { title: "The Farmer and the Stork", story: "A farmer set traps for cranes that were eating his seeds. He caught a stork along with the cranes. The stork pleaded for its life, saying it was not a crane. The farmer replied, 'You may be innocent, but you were found in bad company.' Moral: You are judged by the company you keep." }, { title: "The Fox and the Grapes", story: "A fox saw a bunch of grapes hanging high on a vine and tried to reach them. After failing, he walked away scornfully, saying, 'I'm sure they were sour anyway.' Moral: It's easy to despise what you cannot have." }, { title: "The Goose with the Golden Eggs", story: "A farmer had a goose that laid a golden egg every day. Impatient to get all the gold at once, he cut the goose open, only to find it was just a normal goose inside. He lost his daily treasure. Moral: Greed can destroy the source of your good fortune." }, { title: "The Empty Boat", story: "A man was rowing when another boat bumped into his. He yelled angrily, but saw the other boat was empty. His anger vanished. He realized his anger came from within, based on the assumption of another person's fault. Moral: Our anger is often a reaction from our own minds, not caused by others." }, { title: "The Two Wolves", story: "An old Cherokee told his grandson about a battle inside him between two wolves. One is evil: anger, envy, and greed. The other is good: joy, peace, love, and hope. The grandson asked which wolf wins. The old man replied, 'The one you feed.' Moral: The path you take in life is determined by the thoughts and feelings you choose to nurture." }, { title: "The Cracked Pot", story: "A water-bearer had two pots. One was perfect, the other had a crack and leaked water. The cracked pot felt ashamed. But the bearer explained he had planted seeds on the side of the path with the crack, and the leaking water had made them grow into beautiful flowers. Moral: Our flaws and imperfections can be sources of unique beauty and strength." }, { title: "The Obstacle in Our Path", story: "A king placed a large boulder on a road. Many people complained and went around it. A peasant came by, and instead of complaining, he strained and pushed the boulder out of the way. Underneath, he found a purse of gold and a note from the king saying the gold was for the person who removed the obstacle. Moral: Every obstacle presents an opportunity to improve one's condition." }, { title: "The Three Stone Masons", story: "A traveler asked three stone masons what they were doing. The first grumbled, 'I'm cutting this stone.' The second said, 'I'm earning a living.' The third looked up with a smile and said, 'I'm building a great cathedral.' Moral: Perspective and purpose transform a task into a passion." }, { title: "The Emperor's Seeds", story: "An emperor gave a seed to every child and said whoever grew the most beautiful flower would be his successor. One boy, Ling, couldn't get his seed to grow, no matter how hard he tried. Ashamed, he brought his empty pot to the emperor. The emperor revealed all the seeds had been boiled and couldn't grow. He chose Ling for his honesty. Moral: Honesty is more important than any accomplishment." }, { title: "The Butterfly's Struggle", story: "A man watched a butterfly struggling to emerge from its chrysalis. Wanting to help, he snipped the chrysalis open. The butterfly emerged easily, but its wings were shriveled and it could never fly. The struggle was necessary to push fluid into its wings so it could be strong enough to fly. Moral: Struggles are what give us the strength we need to succeed in life." }, { title: "The Wise Man and the Insult", story: "A man insulted a wise sage, who remained perfectly calm. The man asked how he could stay so calm. The sage replied, 'If you offer me a gift and I do not accept it, to whom does the gift belong?' The man answered, 'To me.' The sage smiled, 'The same is true of your anger and insults.' Moral: You have the power to choose whether or not to accept someone else's negativity." }, { title: "The Starfish Story", story: "A person was walking on a beach covered with thousands of starfish that had washed ashore. They began throwing them back in the water one by one. A man said, 'You can't possibly make a difference.' The person threw another starfish in and replied, 'I made a difference to that one.' Moral: Even small acts of kindness can make a big difference." }, { title: "The King's Two Birds", story: "A king was given two identical falcons. One soared majestically, but the other never left its branch. The king offered a reward to anyone who could make it fly. A farmer succeeded. He explained, 'I simply cut the branch where the bird was sitting.' Moral: Sometimes, we need to leave our comfort zone to discover our true potential." }, { title: "The Parable of the Pencil", story: "A pencil maker told his pencil it could be great, but it must endure sharpening, which would be painful. It must allow someone to guide it. It must be able to correct its mistakes. And its most important part would always be what's inside. Moral: We all have the potential for greatness, but it requires facing challenges, accepting guidance, learning from mistakes, and knowing our true value comes from within." }, { title: "The Farmer and the Well", story: "A farmer's donkey fell into a well. The farmer decided to bury it. As he shoveled dirt onto the donkey, it would shake the dirt off and step up. He kept shoveling, and the donkey kept shaking and stepping up, until it was high enough to walk out. Moral: What seems like something that could bury you can be used as a stepping stone to rise above your problems." }, { title: "The House with the Golden Windows", story: "A young girl lived in a house and dreamed of living in the house with golden windows across the valley. One day, she journeyed to it, only to find it was plain. When she looked back, she saw her own house, now bathed in the setting sun, had windows of gold. Moral: The beauty and happiness we seek is often found right where we are, if we only look at it from the right perspective." }, { title: "The Man and the Gnat", story: "A gnat challenged a lion, saying it was mightier. The gnat buzzed around, biting the lion in tender spots. The lion, unable to catch it, gave up. The gnat buzzed away in triumph, but flew straight into a spider's web and was eaten. Moral: Do not let a small victory make you careless about greater dangers." }, { title: "The Oak and the Reeds", story: "A proud oak tree boasted of its strength, while mocking the reeds for bending so easily in the wind. A great storm came, and the mighty oak was torn up by its roots, while the reeds, which bent with the wind, were left unharmed. Moral: It is better to be flexible and adaptable than to be stubborn and break." },
    ];
    const allSkills = [
        { title: "The Art of Active Listening", lesson: "Active listening is more than just being quiet; it's about making someone feel truly heard. When someone is speaking, focus entirely on them, not on what you'll say next. Make eye contact and nod. When they're done, try summarizing what you heard, like 'So, it sounds like you felt frustrated because...' This builds strong bonds of trust." },
        { title: "Giving a Sincere Apology", lesson: "A good apology can fix almost anything. It has three parts: 1) Say 'I'm sorry for...' and name what you did. 2) Show you understand how it made them feel. 3) Say what you will do differently. Skipping any of these steps can make an apology feel empty. A real apology is about taking responsibility, not just saying words." },
        { title: "The 'Two-Minute' Rule for Chores", lesson: "Procrastination is the enemy of a tidy space! If you see a task that can be done in two minutes or less (like putting a dish in the dishwasher or wiping a counter), do it immediately. These tiny actions add up and prevent small messes from becoming big projects." },
        { title: "How to Disagree Respectfully", lesson: "It's normal to disagree, but it's important to do it kindly. Instead of saying 'You're wrong,' use 'I' statements. Say 'I see it differently...' instead of attacking their idea. The goal isn't to 'win,' but to understand the other person's point of view and find common ground." },
        { title: "The Habit of Gratitude", lesson: "Gratitude is like a muscle; the more you use it, the stronger it gets. Each day, try to name three specific things you are grateful for. Don't just say 'my family.' Be specific, like 'I'm grateful that Mom packed my favorite snack today.' This trains your brain to look for the good in your life." },
        { title: "How to Set a SMART Goal", lesson: "A goal without a plan is just a wish. To make a goal real, make it 'SMART': Specific, Measurable, Achievable, Relevant, and Time-bound. Instead of 'I want to be better at reading,' a SMART goal is 'I will read one chapter of a book every night for the next two weeks.' This gives you a clear path to success." },
        { title: "The Power of a Firm Handshake", lesson: "A handshake is often part of a first impression. A good one shows confidence. Look the person in the eye, smile, and offer your hand. Your grip should be firm but not crushing‚Äîmatch the pressure of the other person. A confident handshake says, 'I'm happy to meet you and I am here.'" },
        { title: "How to Read a Nutrition Label", lesson: "Understanding a nutrition label helps you make healthy choices. Start with the 'Serving Size' at the top. All the numbers below apply to that single serving. Look at calories for energy, but also check for things you want less of (like sodium and added sugars) and things you want more of (like fiber and protein)." },
        { title: "The 'Five Finger' Breathing Technique", lesson: "When you feel anxious or overwhelmed, use your hand to calm down. Hold one hand up and slowly trace the outside of your fingers with the index finger of your other hand. Breathe in as you trace up a finger, and breathe out as you trace down. Do this for all five fingers to slow your heart rate and clear your mind." },
        { title: "How to Be a Good Digital Citizen", lesson: "Being a good citizen extends to the internet. This means being kind and respectful in comments and messages, thinking before you share personal information, and giving credit when you use someone else's work or photo. Treat people online with the same respect you would in person." },
        { title: "Understanding 'Needs' vs. 'Wants'", lesson: "This is a key to managing money. A 'need' is something essential for survival, like food, water, and a safe place to live. A 'want' is something that's nice to have but not essential, like a new video game or brand-name shoes. Learning the difference helps you make smart spending decisions." },
        { title: "How to Give a Genuine Compliment", lesson: "A good compliment can make someone's day. Be specific! Instead of saying 'You're nice,' try 'I really appreciated how you helped me with that project.' Complimenting someone's effort or character ('You worked so hard on that!') is often more meaningful than complimenting an outcome ('You got an A+')." },
        { title: "The Importance of Sleep", lesson: "Sleep isn't just 'rest'; it's when your brain and body repair themselves. Your brain sorts and stores memories, and your body grows and fights off sickness. Not getting enough sleep can make it hard to focus, learn, and manage your emotions. Aiming for a consistent bedtime helps your body's internal clock work its magic." },
        { title: "How to Be a Critical Thinker Online", lesson: "Don't believe everything you see online! Before you share a surprising post or news story, ask yourself: Who created this? Is it from a reliable source? Are they trying to sell me something or make me feel a strong emotion? Looking for facts from multiple trusted sources is a superpower in the digital age." },
        { title: "The 'Eat the Frog' Method for Homework", lesson: "Mark Twain once said that if the first thing you do each morning is to eat a live frog, you can go through the day with the satisfaction of knowing that that is probably the worst thing that is going to happen to you all day long. Your 'frog' is your most difficult or least favorite task. Do that task first! Once it's done, the rest of your work will feel much easier." },
        { title: "Basic First Aid for a Burn", lesson: "For a minor burn (like from touching a hot pan), immediately run cool‚Äînot cold‚Äîwater over the area for several minutes. Do not use ice, as it can damage the skin. After cooling, you can cover it loosely with a sterile bandage. This simple action can reduce the severity of the burn significantly." },
        { title: "The Power of 'Yet'", lesson: "It's easy to get frustrated and say 'I can't do this.' A simple way to change your mindset is to add the word 'yet' to the end of that sentence. 'I can't do this... yet.' This small word opens up the possibility of future success and transforms a fixed mindset (I'm not good at this) into a growth mindset (I can learn and improve)." },
        { title: "How to Sew on a Button", lesson: "Knowing how to sew on a button is a simple but very useful skill. You'll need a needle and thread. Push the threaded needle up through the fabric and one hole of the button, then down through the opposite hole. Repeat this 5-6 times. Then, wrap the thread around the threads under the button a few times to create a shank, and tie a knot on the back of the fabric." },
        { title: "The 'HALT' Check-in for Emotions", lesson: "Sometimes you feel upset or grumpy and don't know why. Use the 'HALT' acronym to check in with yourself. Ask: Am I Hungry? Am I Angry? Am I Lonely? Am I Tired? Often, a basic physical or emotional need is the root cause of a bad mood. Addressing it directly‚Äîby eating a snack, taking a deep breath, calling a friend, or resting‚Äîcan make a huge difference." },
        { title: "How to Write a Clear To-Do List", lesson: "A good to-do list helps you feel in control. Instead of vague tasks like 'clean room,' break it down into small, actionable steps like 'make bed,' 'put away clothes,' and 'wipe desk.' This makes the work seem less overwhelming and gives you the satisfaction of checking off multiple items as you go." },
    ];
    let usedContent = {};

    // --- CORE FUNCTIONS ---
    function initializeApp() {
        document.getElementById('subtitle').textContent = subtitles[Math.floor(Math.random() * subtitles.length)];
        initializeUsedContent();
    }

    function initializeUsedContent() { usedContent = { iceBreakers: [], stories: [], skills: [] }; }
    
    function startMeeting() {
        const cards = ['iceBreaker', 'famousQuote', 'interestingFact', 'moralStory', 'lifeSkill', 'jokeContent'];
        cards.forEach(id => {
            const el = document.getElementById(id);
            if (el) {
                if (id === 'famousQuote') {
                    el.innerHTML = '<blockquote>An inspiring quote will appear here...</blockquote>';
                } else {
                    const h2Text = el.parentElement.querySelector('h2').textContent;
                    el.innerHTML = `<p>Click the button to get a ${h2Text.toLowerCase()}!</p>`;
                }
            }
        });
        document.querySelectorAll('.meeting-box').forEach(card => card.classList.remove('card-used'));
        initializeApp(); 
        alert("New meeting started! Content and progress is refreshed.");
    }

    function setButtonLoadingState(button, isLoading, originalText) {
        button.disabled = isLoading;
        button.textContent = isLoading ? 'Loading...' : originalText;
    }
    
    function markCardUsed(button) { button.closest('.meeting-box').classList.add('card-used'); }

    async function fetchApiContent(url, button, originalText, formatter) {
        setButtonLoadingState(button, true, originalText);
        markCardUsed(button);
        try {
            const response = await fetch(url);
            if (!response.ok) throw new Error(`Network response was not ok (status: ${response.status})`);
            const data = await response.json();
            return formatter(data);
        } catch (error) {
            console.error('Fetch Error:', error);
            return `<p style="color: #ff6b6b; font-weight: bold;">Oops! ${error.message}</p>`;
        } finally {
            setButtonLoadingState(button, false, originalText);
        }
    }

    async function generateFact(button) {
        const formatter = (data) => {
            if (data && data.text) return `<p>${data.text}</p>`;
            throw new Error("Invalid data format for fact.");
        };
        document.getElementById('interestingFact').innerHTML = await fetchApiContent(API_URLS.fact, button, 'Discover Fact', formatter);
    }
    
    // --- UPDATED QUOTE FUNCTION ---
    async function generateQuote(button) {
        const formatter = (data) => {
            // ZenQuotes API returns an array, so we access the first element
            const quoteData = data[0]; 
            if (quoteData && quoteData.q && quoteData.a) {
                return `<blockquote>${quoteData.q}<br><em>- ${quoteData.a}</em></blockquote>
                        <div class="quote-attribution">
                            Inspirational quotes provided by <a href="https://zenquotes.io/" target="_blank">ZenQuotes API</a>
                        </div>`;
            }
            throw new Error("Invalid data format for quote.");
        };
        document.getElementById('famousQuote').innerHTML = await fetchApiContent(API_URLS.quote, button, 'Get Quote', formatter);
    }
    
    async function generateJoke(button) {
        const formatter = (data) => {
            if (data && data.setup && data.punchline) return `<p><strong>${data.setup}</strong><br><em>${data.punchline}</em></p>`;
            throw new Error("Invalid data format for joke.");
        };
        document.getElementById('jokeContent').innerHTML = await fetchApiContent(API_URLS.joke, button, 'Tell Joke', formatter);
    }

    function getRandomItem(itemType, itemsArray) {
        if (!itemsArray || itemsArray.length === 0) return null;
        let available = itemsArray.filter((_, i) => !usedContent[itemType].includes(i));
        if (available.length === 0) {
            usedContent[itemType] = [];
            available = itemsArray;
        }
        const randomIndex = Math.floor(Math.random() * available.length);
        const item = available[randomIndex];
        usedContent[itemType].push(itemsArray.indexOf(item));
        return item;
    }

    function generateStaticContent(button, originalText, itemType, array, elementId, formatter) {
        setButtonLoadingState(button, true, originalText);
        markCardUsed(button);
        setTimeout(() => {
            const item = getRandomItem(itemType, array);
            document.getElementById(elementId).innerHTML = item ? formatter(item) : `<p>Add more content!</p>`;
            setButtonLoadingState(button, false, originalText);
        }, 200);
    }
    
    function generateIceBreaker(button) { generateStaticContent(button, 'Get Question', 'iceBreakers', allIceBreakers, 'iceBreaker', item => `<p>${item}</p>`); }
    function generateStory(button) { generateStaticContent(button, 'Tell Story', 'stories', allStories, 'moralStory', item => `<h3>${item.title}</h3><p>${item.story}</p>`); }
    function generateSkill(button) { generateStaticContent(button, 'Learn Skill', 'skills', allSkills, 'lifeSkill', item => `<h3>${item.title}</h3><p>${item.lesson}</p>`); }
    
    // --- MODAL, THEME, and NOTES functions ---
    function showHelpModal() { document.getElementById('helpModal').style.display = 'block'; }
    function closeHelpModal() { document.getElementById('helpModal').style.display = 'none'; }
    function showRulesModal() { document.getElementById('rulesModal').style.display = 'block'; }
    function closeRulesModal() { document.getElementById('rulesModal').style.display = 'none'; }
    
    window.onclick = function(event) {
        if (event.target.classList.contains('modal')) {
            event.target.style.display = "none";
        }
    }
    
    function changeTheme() {
        currentThemeIndex = (currentThemeIndex + 1) % themes.length;
        document.body.className = themes[currentThemeIndex];
    }
    
    function exportNotes() {
        const notes = document.getElementById('meetingNotes').value;
        if (!notes.trim()) { alert("Notes are empty!"); return; }
        const blob = new Blob([notes], { type: 'text/plain;charset=utf-8' });
        const link = document.createElement('a');
        link.download = `Meeting-Notes-${new Date().toISOString().slice(0, 10)}.txt`;
        link.href = URL.createObjectURL(blob);
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(link.href);
        markCardUsed(document.querySelector('#card-notes .random-btn'));
    }
    
    document.addEventListener('DOMContentLoaded', initializeApp);
</script>
</body>
</html>
