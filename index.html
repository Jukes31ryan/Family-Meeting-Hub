<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gather</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;800&display=swap" rel="stylesheet">
    
    <style>
        :root { --transition: all 0.3s ease; }

        /* THEME: HARVEST (Warm) - PERMANENT */
        body { 
            font-family: 'Outfit', sans-serif; 
            background: linear-gradient(135deg, #fff8e1 0%, #ffecb3 100%);
            background-attachment: fixed;
            color: #3e2723;
            min-height: 100vh; 
            padding: 20px; 
            display: flex; 
            flex-direction: column;
            --accent: #d84315;
            --glass-bg: rgba(255, 255, 255, 0.95);
            --border: #ffe0b2;
            --card-shadow: 0 4px 12px rgba(216, 67, 21, 0.1);
            --btn-text: #ffffff;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        .container { max-width: 900px; margin: 0 auto; width: 100%; }

        header { text-align: center; margin-bottom: 20px; }
        
        h1 { 
            font-weight: 800; 
            font-size: 3.5rem; 
            margin-bottom: 5px; 
            letter-spacing: -2px; 
            background: linear-gradient(to right, #d84315, #5d4037);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-transform: uppercase;
        }
        
        .tagline { font-size: 1.1rem; color: #6d4c41; margin-bottom: 25px; font-weight: 600; opacity: 0.8; letter-spacing: 0.5px; }

        /* --- GUIDE BUTTON (Small, Centered) --- */
        .guide-container { display: flex; justify-content: center; width: 100%; margin-bottom: 15px; }
        .guide-btn {
            background: transparent;
            border: 1px solid var(--border);
            border-radius: 20px;
            color: #6d4c41;
            padding: 6px 14px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: var(--glass-bg);
            transition: var(--transition);
            box-shadow: var(--card-shadow);
        }
        .guide-btn:hover { color: var(--accent); transform: translateY(-1px); }
        .guide-icon {
            display: flex; justify-content: center; align-items: center;
            width: 16px; height: 16px; border-radius: 50%;
            background: var(--accent); color: white; 
            font-size: 10px; font-weight: bold;
        }

        /* --- GUIDE CONTENT (Idiot-Proof) --- */
        .guide-content { 
            display: none; 
            background: var(--glass-bg); 
            padding: 25px; 
            border-radius: 16px; 
            margin: 10px auto 20px auto; 
            border: 1px solid var(--accent); 
            font-size: 1rem; 
            line-height: 1.6; 
            text-align: left; 
            max-width: 500px;
            animation: fadeIn 0.3s ease;
            box-shadow: var(--card-shadow);
        }
        .guide-step { display: flex; gap: 15px; margin-bottom: 15px; align-items: flex-start; }
        .step-num { color: var(--accent); font-weight: 800; min-width: 25px; font-size: 1.2rem; }
        .guide-text strong { display: block; margin-bottom: 3px; color: var(--accent); }

        /* --- GRID --- */
        .grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); 
            gap: 16px; 
            align-items: stretch; 
        }

        .card { 
            background: var(--glass-bg); 
            border: 1px solid var(--border); 
            border-radius: 16px; 
            padding: 20px; 
            display: flex; 
            flex-direction: column; 
            justify-content: space-between;
            transition: var(--transition); 
            box-shadow: var(--card-shadow); 
            position: relative; 
            backdrop-filter: blur(12px);
            height: 100%;
        }
        .card:hover { transform: translateY(-3px); border-color: var(--accent); }

        .card-feature { grid-column: 1 / -1; }
        .card-feature h3 { font-size: 1.4rem !important; margin-bottom: 10px !important; }
        .card-feature p { font-size: 1.1rem !important; line-height: 1.6 !important; }

        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .tag { font-size: 0.65rem; text-transform: uppercase; letter-spacing: 1.2px; font-weight: 800; color: var(--accent); opacity: 0.9; border: 1px solid var(--accent); padding: 3px 8px; border-radius: 6px; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        .card-content { flex-grow: 1; margin-bottom: 20px; font-size: 1rem; line-height: 1.5; color: var(--text-main); display: flex; flex-direction: column; justify-content: center; animation: fadeIn 0.4s ease-out; min-height: 100px; }
        
        /* Center short text, Left align long text */
        .card-content p { width: 100%; margin: 0; }
        .text-center { text-align: center; }
        .text-left { text-align: left; }

        .card-content h3 { color: var(--accent); margin-bottom: 8px; font-size: 1.1rem; font-weight: 800; width: 100%; text-align: left; }
        
        .cheat-code-box {
            background: rgba(125,125,125,0.1); 
            border-left: 4px solid var(--accent);
            padding: 15px;
            margin-top: 15px;
            border-radius: 0 8px 8px 0;
            font-weight: 500;
            font-size: 0.95rem;
            text-align: left;
        }

        .check-list { list-style: none; width: 100%; text-align: left; padding: 0; margin: 0; }
        .check-list li { padding: 10px 0; border-bottom: 1px solid var(--border); font-size: 0.95rem; color: var(--text-main); display: flex; gap: 10px; line-height: 1.4; }
        .check-list li:last-child { border-bottom: none; }

        .btn { background: #3e2723; color: white; border: none; width: 100%; padding: 14px; border-radius: 12px; font-weight: 700; font-family: 'Outfit', sans-serif; cursor: pointer; transition: var(--transition); font-size: 0.95rem; margin-top: auto; }
        .btn:hover { background: var(--accent); transform: translateY(-2px); }
        .btn:active { transform: scale(0.98); }

        .counter-group { display: flex; align-items: center; gap: 8px; width: 100%; margin-top: auto;}
        .counter-btn { width: 40px; height: 40px; border-radius: 10px; background: transparent; border: 2px solid var(--border); font-size: 1.1rem; font-weight: bold; color: var(--text-main); cursor: pointer; display: flex; align-items: center; justify-content: center; transition: var(--transition); }
        .counter-btn:hover { border-color: var(--accent); color: var(--accent); background: rgba(255,255,255,0.05); }
        .counter-val { flex-grow: 1; text-align: center; font-size: 1rem; font-weight: 800; }

        .sponsor-area { margin-top: 40px; text-align: center; padding-bottom: 20px; }
        .sponsor-link { color: var(--accent); font-weight: 700; text-decoration: none; margin-left: 5px; opacity: 0.8; font-size: 0.9rem; }
        .sponsor-link:hover { text-decoration: underline; opacity: 1; }

        @media (max-width: 768px) { 
            h1 { font-size: 2.8rem; } 
            .card-feature { padding: 20px; }
        }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1>GATHER</h1>
            <div class="tagline">Meaningful conversations, made easy.</div>
            
            <div class="guide-container">
                <button class="guide-btn" onclick="toggleGuide()">
                    <div class="guide-icon">?</div> How it works
                </button>
            </div>
            
            <div id="guide-box" class="guide-content">
                <div class="guide-step">
                    <div class="step-num">1.</div>
                    <div class="guide-text"><strong>The Device Rule</strong><br>This is the only screen allowed. Everyone else puts their phone away.</div>
                </div>
                <div class="guide-step">
                    <div class="step-num">2.</div>
                    <div class="guide-text"><strong>Set the Stage</strong><br>Place this phone in the middle of the table (or prop it up).</div>
                </div>
                <div class="guide-step">
                    <div class="step-num">3.</div>
                    <div class="guide-text"><strong>Pass the Baton</strong><br>One person reads a card. Everyone answers. Then, pass the phone to the next person to read.</div>
                </div>
                <div class="guide-step">
                    <div class="step-num">4.</div>
                    <div class="guide-text"><strong>Go Deeper</strong><br>Start with "Warm Up." Move to "Wisdom" or "Lesson" when the group is ready for something real.</div>
                </div>
            </div>
        </header>

        <div class="grid">
            
            <div class="card">
                <div class="card-header"><span class="tag">Warm Up</span></div>
                <div class="card-content text-center" id="content-iceBreaker"><p>Loading...</p></div>
                <button class="btn" onclick="generate('iceBreaker')">Next Question</button>
            </div>

            <div class="card">
                <div class="card-header"><span class="tag">Check In</span></div>
                <div class="card-content" style="display:block;">
                    <ul class="check-list" id="list-checkin"></ul>
                </div>
                <div class="counter-group">
                    <button class="counter-btn" onclick="adjustCount(-1)">-</button>
                    <span class="counter-val" id="count-display">4 People</span>
                    <button class="counter-btn" onclick="adjustCount(1)">+</button>
                    <button class="btn" style="width: auto;" onclick="generateOrder()">Order</button>
                </div>
                <div id="checkInOrder" style="margin-top: 10px; font-weight: bold; color: var(--accent); font-size: 0.9rem; text-align: center;"></div>
            </div>

            <div class="card">
                <div class="card-header"><span class="tag">Wisdom</span></div>
                <div class="card-content text-center" id="content-quote"><p>Loading...</p></div>
                <button class="btn" onclick="generate('quote')">Next Quote</button>
            </div>

            <div class="card card-feature">
                <div class="card-header"><span class="tag">Lesson</span></div>
                <div class="card-content text-left" id="content-dynamic" style="display: block;"><p>Loading...</p></div>
                <button class="btn" onclick="generate('dynamic')" style="width: auto; margin: 0 auto; display: block; padding: 12px 30px;">Read Next Lesson</button>
            </div>

            <div class="card">
                <div class="card-header"><span class="tag">Humor</span></div>
                <div class="card-content text-center" id="content-joke"><p>Loading...</p></div>
                <button class="btn" onclick="generateJoke()">Next Joke</button>
            </div>

            <div class="card">
                <div class="card-header"><span class="tag">Growth</span></div>
                <div class="card-content text-left" id="content-skill"><p>Loading...</p></div>
                <button class="btn" onclick="generate('skill')">Next Skill</button>
            </div>

            <div class="card">
                <div class="card-header"><span class="tag">Wonder</span></div>
                <div class="card-content text-center" id="content-fact"><p>Loading...</p></div>
                <button class="btn" onclick="generateFact()">Get Fact</button>
            </div>

        </div>

        <div class="sponsor-area">
            <span id="ad-text" style="opacity: 0.6; font-size: 0.8rem;">Brought to you by</span><br>
            <a href="https://noblerealtywv.com" target="_blank" class="sponsor-link" id="ad-link">Noble Realty WV &rarr;</a>
            <div style="margin-top: 5px; font-size: 0.8rem; opacity: 0.7;">Serving Community Heroes First.</div>
        </div>
    </div>

    <script src="data.js"></script>

    <script>
        if (typeof db === 'undefined') {
            document.body.innerHTML = "<div style='text-align:center; padding:50px; font-family:sans-serif;'><h1>⚠️ Connection Error</h1><p>I cannot find your <strong>data.js</strong> file.</p><p>Make sure both <strong>index.html</strong> and <strong>data.js</strong> are in the same folder on GitHub.</p></div>";
        }

        // --- SINGLE MODE: FAMILY DINNER ---
        let participants = 4;
        let usedIndices = { iceBreaker: [], quote: [], dynamic: [], skill: [] };

        // Auto-Run on Load
        window.onload = () => {
            initApp();
        };

        function initApp() {
            // Load "Dinner" data by default since we are single mode now
            const d = db.dinner; 
            
            // Populate Check-in List
            const list = document.getElementById('list-checkin');
            list.innerHTML = '';
            d.checkin.forEach(item => {
                const li = document.createElement('li');
                li.innerHTML = item;
                list.appendChild(li);
            });

            // Set Footer info
            document.getElementById('ad-text').innerText = d.ad_text;
            document.getElementById('ad-link').innerText = d.ad_link;

            // Generate initial cards
            generate('iceBreaker');
            generate('quote');
            generate('dynamic');
            generate('skill');
            generateJoke();
            generateFact();
        }

        function generate(type) {
            const d = db.dinner; // Always use dinner data
            let pool = [];
            
            if (type === 'iceBreaker') pool = d.iceBreakers;
            else if (type === 'quote') pool = d.quotes;
            else if (type === 'dynamic') pool = d.dynamics;
            else if (type === 'skill') pool = d.skills;

            if (!pool || pool.length === 0) return;

            let index;
            let attempts = 0;
            do {
                index = Math.floor(Math.random() * pool.length);
                attempts++;
                if (usedIndices[type].length >= pool.length) { usedIndices[type] = []; break; }
            } while (usedIndices[type].includes(index) && attempts < 100);
            
            usedIndices[type].push(index);
            const item = pool[index];
            const container = document.getElementById('content-' + type);
            
            // Create fresh container to reset content
            const newContainer = container.cloneNode(false); // Clone without children
            newContainer.id = container.id; // Ensure ID is kept

            if (type === 'quote') {
                newContainer.innerHTML = `<p class="quote-style">"${item.text}"<br><span style="font-size:0.85rem; font-weight:normal; margin-top:5px; display:block;">- ${item.author}</span></p>`;
            } else if (typeof item === 'string') {
                newContainer.innerHTML = `<p>${item}</p>`;
            } else {
                // For Stories/Skills (Object with Title/Body)
                newContainer.innerHTML = `<h3>${item.title}</h3><p>${item.body}</p>`;
            }
            container.parentNode.replaceChild(newContainer, container);
        }

        function generateJoke() {
            const container = document.getElementById('content-joke');
            const newContainer = container.cloneNode(false);
            newContainer.innerHTML = "Thinking...";
            container.parentNode.replaceChild(newContainer, container);
            fetch('https://official-joke-api.appspot.com/random_joke')
                .then(r => r.json())
                .then(data => { newContainer.innerHTML = `<p><strong>${data.setup}</strong><br><em>${data.punchline}</em></p>`; })
                .catch(() => { newContainer.innerHTML = "<p>Why did the developer go broke? He used up all his cache.</p>"; });
        }

        function generateFact() {
            const container = document.getElementById('content-fact');
            const newContainer = container.cloneNode(false);
            newContainer.innerHTML = "Thinking...";
            container.parentNode.replaceChild(newContainer, container);
            fetch('https://uselessfacts.jsph.pl/random.json?language=en')
                .then(r => r.json())
                .then(data => { newContainer.innerHTML = `<p>${data.text}</p>`; })
                .catch(() => { newContainer.innerHTML = "<p>Honey never spoils. Archaeologists have found pots of honey in ancient Egyptian tombs that are over 3,000 years old and still edible.</p>"; });
        }

        function adjustCount(change) {
            participants += change;
            if (participants < 2) participants = 2;
            if (participants > 20) participants = 20;
            document.getElementById('count-display').innerText = participants + " People";
        }

        function generateOrder() {
            let arr = [];
            for(let i=1; i<=participants; i++) arr.push(i);
            arr.sort(() => Math.random() - 0.5);
            document.getElementById('checkInOrder').innerText = "Order: Person " + arr.join(" → ");
        }

        function toggleGuide() {
            const guide = document.getElementById('guide-box');
            if (guide.style.display === 'block') {
                guide.style.display = 'none';
            } else {
                guide.style.display = 'block';
            }
        }
    </script>

</body>
</html>
