<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Family Meeting Hub</title>
    <style>
        :root {
            --glass-bg: rgba(255, 255, 255, 0.35);
            --glass-border: rgba(255, 255, 255, 0.25);
            --text-primary: #333;
            --text-secondary: #555;
            --shadow-light: 0 8px 32px rgba(31, 38, 135, 0.2);
            --button-disabled-bg: #ccc;
            --progress-glow-color: #ff7e5f;
            --btn-gradient: linear-gradient(135deg, #ff7e5f 0%, #feb47b 100%);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            min-height: 100vh;
            color: var(--text-primary);
            transition: background 0.5s ease;
            overflow-x: hidden;
            /* Default: Family */
            background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%);
        }

        /* --- MODE THEMES --- */
        body[data-mode="family"] { background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%); }
        body[data-mode="friends"] { background: linear-gradient(135deg, #89f7fe 0%, #66a6ff 100%); }
        body[data-mode="work"] { background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%); }

        /* Dark Theme Support */
        body.dark-theme {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            --glass-bg: rgba(0, 0, 0, 0.25);
            --glass-border: rgba(255, 255, 255, 0.1);
            --text-primary: #f8fafc;
            --text-secondary: #cbd5e1;
            --button-disabled-bg: #555;
            --progress-glow-color: #f59e0b;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 2;
        }

        /* HEADER */
        .header {
            text-align: center;
            padding: 2rem 1rem;
            margin-bottom: 2rem;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            box-shadow: var(--shadow-light);
            backdrop-filter: blur(10px);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .header h1 { font-size: 2.5rem; margin-bottom: 0.5rem; }
        .header p { font-size: 1.2rem; opacity: 0.9; }

        /* CONTROLS */
        .controls {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .control-btn, .mode-select {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            color: var(--text-primary);
            padding: 12px 24px;
            border-radius: 30px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
            font-family: inherit;
        }

        .control-btn:hover { transform: translateY(-3px); box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        
        /* GRID */
        .meeting-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 28px;
        }

        .meeting-box {
            background: var(--glass-bg);
            border: 2px solid transparent;
            border-radius: 20px;
            padding: 25px;
            box-shadow: var(--shadow-light);
            backdrop-filter: blur(10px);
            display: flex;
            flex-direction: column;
            transition: border-color 0.4s ease, box-shadow 0.4s ease;
        }
        
        .card-used {
            border-color: var(--progress-glow-color);
            box-shadow: 0 0 20px var(--progress-glow-color);
        }

        .meeting-box h2 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .content { 
            flex-grow: 1; 
            margin-bottom: 1rem; 
            line-height: 1.6; 
        }
        .content ul { list-style-position: inside; padding-left: 10px; }
        .content p, .content ul { margin-bottom: 10px; }
        .content h3 { margin-bottom: 10px; font-size: 1.2rem; }
        .content blockquote { font-style: italic; padding-left: 15px; border-left: 3px solid var(--text-secondary); margin-left: 0; opacity: 0.9; }

        /* BUTTONS */
        .random-btn {
            background: var(--btn-gradient);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 0.95rem;
            align-self: flex-start;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            font-weight: bold;
        }
        .random-btn:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0,0,0,0.2); }
        .random-btn:disabled { background: var(--button-disabled-bg); cursor: not-allowed; opacity: 0.7; }

        .notes-area { 
            width: 100%; min-height: 100px; padding: 10px; 
            border-radius: 10px; border: 1px solid var(--glass-border); 
            background-color: rgba(255, 255, 255, 0.5); 
            color: var(--text-primary); font-family: inherit; 
        }
        .dark-theme .notes-area { background-color: rgba(0, 0, 0, 0.3); }

        /* MODAL */
        .modal {
            display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%;
            overflow: auto; background-color: rgba(0,0,0,0.6); backdrop-filter: blur(5px);
        }
        .modal-content {
            background: rgba(255, 255, 255, 0.95); color: #2d3748;
            margin: 10% auto; padding: 30px; border-radius: 20px;
            max-width: 600px; width: 90%; position: relative;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        .dark-theme .modal-content { background: rgba(30, 41, 59, 0.95); color: #f7fafc; }
        .modal-close { position: absolute; top: 15px; right: 25px; font-size: 2rem; cursor: pointer; }
    </style>
</head>
<body data-mode="family">

    <div class="container">
        <header class="header">
            <h1 id="main-title">‚ú® Family Meeting Hub</h1>
            <p id="subtitle">Time to connect and share.</p>
        </header>

        <div class="controls">
            <select class="mode-select" id="modeSelect" onchange="changeMode()">
                <option value="family">üè† Family Mode</option>
                <option value="friends">üéâ Friends Mode</option>
                <option value="work">üíº Work Mode</option>
            </select>
            
            <button class="control-btn" onclick="showHelpModal()">‚ùì Help</button>
            <button class="control-btn" onclick="showRulesModal()">üìú Rules</button>
            <button class="control-btn" onclick="location.reload()">üîÑ Reset</button>
            <button class="control-btn" onclick="toggleDarkTheme()">üåó Theme</button>
        </div>

        <div class="meeting-grid">
            
            <div class="meeting-box">
                <h2 id="lbl-icebreaker">üéØ Ice Breaker</h2>
                <div class="content" id="iceBreakerContent">
                    <p>Let's get the conversation flowing!</p>
                </div>
                <button class="random-btn" onclick="generate('iceBreaker')">Get Question</button>
            </div>

            <div class="meeting-box">
                <h2 id="lbl-quote">üí¨ Inspiring Quote</h2>
                <div class="content" id="quoteContent">
                    <blockquote>An inspiring quote will appear here...</blockquote>
                </div>
                <button class="random-btn" onclick="generate('quote')">Get Quote</button>
            </div>

            <div class="meeting-box">
                <h2 id="lbl-checkin">üíñ Check-In</h2>
                <div class="content">
                    <p id="checkin-instruct">Use <strong>Rose, Bud, Thorn</strong> format:</p>
                    <ul id="checkin-list">
                        <li><strong>üåπ Rose:</strong> A highlight.</li>
                        <li><strong>üå± Bud:</strong> Something upcoming.</li>
                        <li><strong>üåµ Thorn:</strong> A challenge.</li>
                    </ul>
                    <div style="display: flex; gap: 10px; align-items: center; margin-top: 15px;">
                        <input type="number" id="participantCount" class="notes-area" placeholder="#" style="width: 60px; min-height: 44px; text-align: center; padding: 10px;">
                        <button class="random-btn" onclick="generateOrder()" style="flex-grow: 1;">Pick Order</button>
                    </div>
                    <div id="checkInOrder" style="margin-top: 1rem; font-weight: bold; color: var(--progress-glow-color);"></div>
                </div>
            </div>

            <div class="meeting-box">
                <h2 id="lbl-dynamic">üìñ Story Time</h2>
                <div class="content" id="dynamicContent">
                    <p>A meaningful story to share...</p>
                </div>
                <button class="random-btn" id="btn-dynamic" onclick="generate('dynamic')">Read Story</button>
            </div>

            <div class="meeting-box">
                <h2 id="lbl-skill">üõ†Ô∏è Life Skill</h2>
                <div class="content" id="skillContent">
                    <p>Learn something valuable together!</p>
                </div>
                <button class="random-btn" id="btn-skill" onclick="generate('skill')">Learn Skill</button>
            </div>

            <div class="meeting-box">
                <h2 id="lbl-joke">üòÇ Joke Time</h2>
                <div class="content" id="jokeContent">
                    <p>Ready for a laugh?</p>
                </div>
                <button class="random-btn" onclick="generate('joke')">Tell Joke</button>
            </div>

            <div class="meeting-box" style="grid-column: 1 / -1;">
                <h2>üìù Meeting Notes</h2>
                <div class="content">
                    <p>Capture important moments:</p>
                    <textarea class="notes-area" id="meetingNotes" placeholder="Write down key points..."></textarea>
                    <div style="margin-top: 16px;">
                        <button class="random-btn" onclick="exportNotes()">üìÑ Export Notes</button>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <div id="helpModal" class="modal"><div class="modal-content"><span class="modal-close" onclick="closeModal('helpModal')">&times;</span><h2>How to Use</h2><ol><li>Select your <strong>Mode</strong> (Family, Friends, Work).</li><li>Start with an <strong>Ice Breaker</strong>.</li><li>Do the <strong>Check-In</strong> round.</li><li>Use the other cards to deepen the conversation.</li></ol></div></div>
    <div id="rulesModal" class="modal"><div class="modal-content"><span class="modal-close" onclick="closeModal('rulesModal')">&times;</span><h2>Meeting Rules</h2><ul><li><strong>Be Present:</strong> No phones.</li><li><strong>One Mic:</strong> Don't interrupt.</li><li><strong>No Judgment:</strong> Listen to understand.</li></ul></div></div>

<script>
    // --- MASSIVE CONTENT DATABASE ---
    const db = {
        family: {
            title: "‚ú® Family Meeting Hub",
            labels: { dynamic: "üìñ Story Time", skill: "üõ†Ô∏è Life Skill", checkin: "üíñ Check-In" },
            btns: { dynamic: "Read Story", skill: "Learn Skill" },
            checkinList: [
                "<strong>üåπ Rose:</strong> A highlight or positive moment.",
                "<strong>üå± Bud:</strong> Something you're looking forward to.",
                "<strong>üåµ Thorn:</strong> A challenge you faced."
            ],
            // RESTORED FULL LIBRARIES FROM ORIGINAL CODE
            iceBreakers: [
                "If you could have a walk-up song play every time you entered a room, what would it be?",
                "What's a small thing that happened this week that made you happy?",
                "If you could instantly become an expert in one thing, what would it be?",
                "What's the most interesting thing you've learned recently?",
                "If you could talk to animals, which animal would you have the most interesting conversation with?",
                "What's a fictional world you would love to live in for a week?",
                "If you had to describe our family as a type of food, what would we be?",
                "What's a skill you'd like to learn as a family?",
                "If you could have any famous artist (living or dead) paint a portrait of our family, who would you choose?",
                "What's a weird food combination that you secretly love?",
                "If you could add a new, magical room to our house, what would it be?",
                "What movie or TV show character do you think is most like you?",
                "If you could design a new planet, what would be its main feature?",
                "What's the best smell in the world?",
                "What's a family tradition you think we should start?",
                "If you could create a new holiday, what would it celebrate and what would be the main tradition?",
                "What's the funniest thing that's ever happened to you?",
                "If you could have any job for just one day, what would you choose?",
                "What's something you're really proud of that you did this week?",
                "If you could have any mythical creature as a pet, what would it be?",
                "What's the most beautiful place you've ever seen?",
                "If you could solve one of the world's mysteries, which one would you pick?",
                "What's one thing you hope to accomplish in the next year?",
                "If you could have a super-power that was only useful for doing chores, what would it be?",
                "What's your favorite thing about the person sitting to your left?",
                "If you could be a movie director, what kind of movie would you make?",
                "What's a word you love the sound of?",
                "If you could have a dinner party with three characters from books, who would you invite?",
                "What's a simple pleasure that always makes your day better?",
                "If our family was a sports team, what would our team name be and what would be our mascot?",
                "What's the best piece of advice you've ever received?",
                "If you could only listen to three songs for the rest of your life, what would they be?",
                "What's something you're looking forward to this month?",
                "If you could have a conversation with any historical figure, who would it be?",
                "What's the most interesting dream you've had recently?",
                "If you had to eat one color of food for a whole day, which color would you choose?",
                "What's something that always makes you laugh without fail?",
                "If you could be a world-famous expert on any topic, what would it be?",
                "What's your favorite memory of just our family?",
                "If you could design a new ride for an amusement park, what would it do?",
                "What's a small act of kindness you saw or did this week?",
                "If you could instantly learn any musical instrument, which one would you pick?",
                "What's the best part about being your current age?",
                "If you could have a magical portal in your room, where would it lead?",
                "What's a question you wish people would ask you more often?",
                "If you could create a new flavor of chips or ice cream, what would it be?",
                "What's a skill you think everyone in our family should learn?",
                "If you could be the main character in any video game, which one would it be?",
                "If you could combine two animals to make one new super-animal, what would you combine?",
                "What's a food that you think is seriously underrated?",
                "If you could have any view from your bedroom window, what would it be?",
                "What's something you've done that you thought was impossible at first?",
                "If you could be a judge on a competition show, what kind of show would it be?",
                "What's something you're really good at that might surprise people?",
                "If you could have any artist's musical talent, whose would you choose?",
                "What's the most interesting-looking cloud you've ever seen?",
                "If you could ask your future self one question, what would it be?",
                "What's a simple thing we could do to make our home even better?",
                "If you could have a conversation with an alien, what's the first thing you would ask?",
                "What's a movie you think everyone in the world should see?",
                "If you could redesign the cover of your favorite book, what would it look like?",
                "What's a small, everyday sound that you love?",
                "If you could bring any character from a book to life to be your friend, who would it be?",
                "What's a challenge you'd be excited to take on?",
                "What's the most memorable meal you've ever had?",
                "If you could create a new law that everyone had to follow, what would it be?",
                "What's a place in our town you'd like to explore more?",
                "If you could have a robot helper, what would be its main job?",
                "What's a song that makes you feel nostalgic?",
                "If you could be a world-renowned scientist, what would you study?",
                "What's the best surprise you've ever had?",
                "If you could have a family motto, what would it be?",
                "What's a piece of good news you've heard recently?",
                "If you could travel anywhere in a submarine, where would you go?",
                "What's a food you could eat every single day and not get tired of?",
                "If you could have one 'do-over' for a single moment in your life, what would it be?",
                "What's something you're looking forward to learning?",
                "What's a funny family story that we don't tell often enough?",
                "What's something you love about every person in this room?",
                "What's a small thing you can do this week to make someone else's day better?",
                "What's the best adventure you've ever been on?",
                "If you could make one thing from a dream become real, what would you choose?",
                "What's a skill you'd like to teach someone else?",
                "If you could have a giant version of any object, what would it be?",
                "What's the best part about being in our family?",
                "Would you rather have the ability to fly or be invisible?",
                "Would you rather be able to talk to all animals or speak every human language?",
                "Would you rather live in a house shaped like a giant shoe or a house shaped like a giant pineapple?",
                "Would you rather have a dragon or a unicorn for a pet?",
                "Would you rather control the weather or be able to teleport?",
                "Would you rather never have to do chores again or never have to do homework again?",
                "Would you rather eat your favorite food for every meal for a year or never be able to eat it again?",
                "Would you rather have a permanent tail or have ears like an elephant?",
                "Would you rather live without music or without movies for the rest of your life?",
                "Would you rather be the funniest person alive or the smartest person alive?",
                "Would you rather explore a new planet by yourself or explore the deepest part of the ocean with your family?",
                "Would you rather have a super-strong sense of smell or super-sensitive hearing?",
                "Would you rather be able to jump as high as a building or run as fast as a car?",
                "Would you rather have everything you draw come to life or be able to understand what animals are thinking?",
                "Would you rather have a personal robot to do your bidding or a magical book that answers any question?",
                "Would you rather only be able to whisper or only be able to shout?",
                "Would you rather live in a world with no pizza or a world with no ice cream?",
                "Would you rather have the power to change the color of anything or the power to change the size of anything?",
                "Would you rather be able to breathe underwater or be able to hold your breath for three hours?",
                "Would you rather have a key that could open any door or a map that shows where any lost item is?"
            ],
            dynamics: [
                { title: "The Lion and the Mouse", body: "A lion was about to eat a mouse, who pleaded for his life. The lion let him go. Later, the lion was trapped in a net. The mouse gnawed the ropes, freeing him. Moral: An act of kindness, no matter how small, is never wasted." },
                { title: "The Tortoise and the Hare", body: "A hare boasted about his speed and challenged a tortoise to a race. The hare, far ahead, took a nap. The tortoise kept moving slowly but steadily and crossed the finish line first. Moral: Slow and steady wins the race." },
                { title: "The Two Frogs", body: "Two frogs fell into a pail of cream. The first gave up and drowned. The second frog kept kicking and kicking until he churned the cream into butter and hopped out. Moral: Never give up." },
                { title: "The Bundle of Sticks", body: "A father showed his sons they could easily break one stick, but couldn't break a bundle of them tied together. Moral: There is strength in unity." },
                { title: "The Ant and the Grasshopper", body: "A grasshopper laughed at an ant for working hard all summer. When winter came, the grasshopper had no food, while the ant was safe and warm. Moral: It is wise to prepare for the days of necessity." },
                { title: "The Fox and the Grapes", body: "A fox saw some juicy grapes but couldn't reach them. He walked away saying, 'They were probably sour anyway.' Moral: It's easy to despise what you cannot have." },
                { title: "The Wind and the Sun", body: "The Wind and the Sun argued about who was stronger. They decided to see who could make a traveler take off his coat. The Wind blew hard, but the traveler held his coat tighter. The Sun shone warmly, and the traveler took it off. Moral: Gentleness and kindness are more powerful than force." },
                { title: "The Wise Old Owl", body: "An old owl sat in an oak. The more he saw, the less he spoke. The less he spoke, the more he heard. Moral: Wise people listen more than they speak." },
                { title: "The Leaky Bucket", body: "A girl carried water in two buckets. One was perfect, the other had a leak. The leaky bucket felt sad, but the girl pointed out the beautiful flowers that grew on its side of the path, watered by the leaks. Moral: Our flaws can sometimes create unexpected beauty." },
                { title: "The Farmer and the Stork", body: "A farmer caught a stork in a net with some cranes that were eating his seeds. The stork pleaded that he was innocent, but the farmer said, 'You were found with the thieves, so you will share their fate.' Moral: You are judged by the company you keep." },
                { title: "The City Mouse and the Country Mouse", body: "A country mouse visited his city cousin and was amazed by the fine food, but terrified by the cats and dogs. He decided it was better to have simple food in peace than fine food in fear. Moral: Peace and safety are more valuable than luxury with danger." },
                { title: "The Boy Who Cried Wolf", body: "A shepherd boy repeatedly tricked villagers into thinking a wolf was attacking his flock. When a wolf actually appeared, no one believed his cries for help, and he lost his sheep. Moral: Liars are not believed even when they speak the truth." },
                { title: "The Dog and Its Reflection", body: "A dog with a piece of meat in his mouth saw his reflection in the water. Thinking it was another dog with a bigger piece, he barked to snatch it, dropping his own meat into the water. Moral: Be content with what you have." },
                { title: "The Oak and the Reeds", body: "A mighty oak tree boasted of its strength to the reeds by the river. A great storm came, and the oak was uprooted, while the flexible reeds bent with the wind and survived. Moral: It is better to be flexible than to be stubborn and rigid." },
                { title: "The Crow and the Pitcher", body: "A thirsty crow found a pitcher with a little water at the bottom. He dropped pebbles into the pitcher one by one until the water level rose high enough for him to drink. Moral: Little by little does the trick; persistence pays off." },
                { title: "The Milkmaid and Her Pail", body: "A milkmaid was carrying a pail of milk, dreaming of all the things she would buy with the money from it. She got so excited that she tossed her head, spilling all the milk. Moral: Do not count your chickens before they hatch." },
                { title: "The Goose with the Golden Eggs", body: "A man owned a goose that laid a golden egg every day. Impatient to get all the gold at once, he killed the goose, only to find it was just like any other goose inside. He lost his daily treasure. Moral: Greed can lead to your own downfall." },
                { title: "The Two Travelers and the Bear", body: "Two friends were walking through a forest when a bear appeared. One quickly climbed a tree, leaving the other behind. The second man lay on the ground and played dead. The bear sniffed him and left. The first man asked what the bear whispered. The second replied, 'He told me never to travel with a friend who deserts you at the first sign of danger.' Moral: Misfortune tests the sincerity of friends." },
                { title: "The Fox and the Crow", body: "A crow had a piece of cheese in her beak. A fox, wanting the cheese, flattered the crow on her beautiful voice and asked her to sing. When the crow opened her beak to sing, the cheese fell out and the fox snatched it up. Moral: Beware of flatterers." },
                { title: "The Lion in Love", body: "A lion fell in love with a woodcutter's daughter and asked for her hand in marriage. The father, not wanting to refuse, said the lion must first have his claws trimmed and his teeth filed. The lion agreed. Once he was harmless, the woodcutter drove him away. Moral: Do not give up your defenses." },
                { title: "The Man and the Serpent", body: "A man found a serpent frozen with cold. He took pity on it and placed it in his bosom. Warmed by the heat, the serpent revived and bit its benefactor, killing him. Moral: No amount of kindness will change the nature of the wicked." },
                { title: "The Donkey in the Lion's Skin", body: "A donkey found a lion's skin and wore it to scare other animals. He was very proud until a fox came along, heard his braying, and knew he was a fake. Moral: Fine clothes may disguise, but silly words will disclose a fool." },
                { title: "The Miser and His Gold", body: "A miser buried his gold and went to look at it every day. A thief watched him, dug up the gold, and stole it. The miser was devastated. A neighbor told him to bury a stone in its place and pretend it was his gold, for it was of no use to him anyway. Moral: Wealth is not to be enjoyed if it is not used." },
                { title: "The Eagle and the Arrow", body: "An eagle was shot by an arrow. As he lay dying, he saw that the arrow was fletched with one of his own feathers. Moral: We often give our enemies the means of our own destruction." },
                { title: "The Wolf in Sheep's Clothing", body: "A wolf disguised himself in a sheep's skin to get into a flock. He ate well for many nights until the shepherd decided to slaughter a sheep for his dinner and chose the wolf by mistake. Moral: The evil you do always comes back to you." },
                { title: "The Honest Woodcutter", body: "A woodcutter dropped his axe in a river. The god Mercury appeared and offered him a golden axe, then a silver one. The woodcutter was honest and said they weren't his. Pleased, Mercury gave him all three axes. Moral: Honesty is the best policy." },
                { title: "The Farmer and His Sons", body: "A dying farmer told his sons there was a treasure hidden in their vineyard. They dug up the entire vineyard but found no gold. However, their digging loosened the soil, resulting in a bountiful harvest. Moral: Hard work itself is a treasure." },
                { title: "The Peacock and the Crane", body: "A peacock mocked a crane for its plain feathers. The crane replied, 'I can fly high among the clouds and the stars, while you are stuck on the ground like a common bird.' Moral: Usefulness is better than beauty." },
                { title: "The Bear and the Bees", body: "A bear tried to steal honey from a beehive but was stung. Enraged, he attacked the hive, causing the entire swarm to attack him. He had to run and jump into a pond to save himself. Moral: It is wiser to bear a single injury in silence than to provoke a thousand by flying into a rage." },
                { title: "The Cat and the Mice", body: "The mice were terrified of a cat. They held a meeting to decide what to do. A young mouse suggested tying a bell around the cat's neck so they would hear it coming. Everyone applauded the idea, but an old mouse asked, 'Who will bell the cat?' Moral: It is one thing to propose a solution, and another to execute it." },
                { title: "The Gnat and the Bull", body: "A gnat landed on a bull's horn and apologized for the inconvenience. The bull replied that he hadn't even noticed the gnat was there. Moral: The smaller the mind the greater the conceit." },
                { title: "The Shepherd and the Wild Sheep", body: "A shepherd found some wild sheep and mixed them with his flock, giving them better food. During a storm, he neglected his own sheep to care for the wild ones. When the storm passed, the wild sheep ran away. The shepherd learned a lesson. Moral: Do not neglect old friends for new ones." },
                { title: "The Fisherman and the Little Fish", body: "A fisherman caught a very small fish, which begged to be thrown back to be caught again when it was bigger. The fisherman refused, saying a small gain now is better than a large gain in the future that is uncertain. Moral: A bird in the hand is worth two in the bush." },
                { title: "The Astronomer", body: "An astronomer was walking along, gazing at the stars, when he fell into a well. A passerby said, 'You who are so eager to see what is in the heavens, you fail to see what is at your feet.' Moral: Pay attention to the immediate and practical." },
                { title: "The Two Pots", body: "An earthenware pot and a brass pot were carried down a river. The earthenware pot tried to keep its distance from the brass one, fearing it would be shattered in a collision. Moral: The strong and the weak cannot keep company." },
                { title: "The Lion and the Boar", body: "A lion and a boar came to a small spring to drink at the same time. They began to fight over who should drink first. After a while, they saw vultures waiting nearby to feast on the loser. They decided it was better to be friends than to be food for vultures. Moral: Those who strive are often watched by others to take advantage of their defeat." },
                { title: "The Miller, His Son, and Their Donkey", body: "A miller and his son were taking their donkey to market. They tried to please everyone they met‚Äîby walking, by letting the son ride, by letting the father ride, and finally by carrying the donkey. In the end, they dropped the donkey into a river and pleased no one. Moral: If you try to please everyone, you will please no one." },
                { title: "The Wolf and the Crane", body: "A wolf had a bone stuck in his throat and hired a crane to remove it. After the crane did so, she asked for her payment. The wolf replied, 'Is it not payment enough that I allowed you to remove your head from my mouth without biting it off?' Moral: Expect no reward for serving the wicked." },
                { title: "The Ant and the Dove", body: "An ant fell into a river. A dove dropped a leaf for the ant to climb on. Later, a hunter was about to catch the dove. The ant bit the hunter on the foot, causing him to miss his shot and saving the dove. Moral: One good turn deserves another." },
                { title: "The Hare and His Ears", body: "A lion was wounded by a goat's horns and declared that all horned animals must leave his kingdom. A hare, seeing the shadow of his long ears, feared they would be mistaken for horns and prepared to flee. Moral: Some people are frightened by their own shadows." }
            ],
            skills: [
                { title: "The Art of Active Listening", body: "Focus entirely on the speaker, don't just wait for your turn. Summarize what they said to show you understand." },
                { title: "Giving a Sincere Apology", body: "A good apology has three parts: 1) Say 'I'm sorry for...' and name what you did. 2) Show you understand how it made them feel. 3) Say what you will do differently." },
                { title: "The 5-Minute Tidy", body: "Before bed, spend just five minutes putting things back where they belong. It makes a huge difference in keeping a space clean and calm." },
                { title: "How to Write a Thank-You Note", body: "Be specific. Instead of 'Thanks for the gift,' say 'Thank you so much for the blue sweater! It's so soft and I can't wait to wear it.' It shows you really appreciate the thought." },
                { title: "Basic Budgeting (The 50/30/20 Rule)", body: "A simple way to manage money. 50% of your income goes to Needs (rent, food), 30% to Wants (hobbies, dining out), and 20% to Savings." },
                { title: "How to Shake Hands Firmly", body: "Make eye contact, smile, and match the other person's grip pressure. A firm, confident handshake makes a great first impression." },
                { title: "The Two-Minute Rule", body: "If a task takes less than two minutes to complete, do it immediately. It prevents small jobs from piling up." },
                { title: "How to Read a Nutrition Label", body: "Pay attention to serving size first. All the numbers (calories, fat, sugar) are based on that amount, which might be smaller than you think." },
                { title: "How to Disagree Respectfully", body: "Use 'I' statements. Instead of 'You're wrong,' try 'I see it differently because...' It focuses on your perspective, not attacking theirs." },
                { title: "How to Learn Someone's Name", body: "When you meet someone, repeat their name back to them. 'It's nice to meet you, Mariana.' It helps lock it in your memory." },
                { title: "The 'Eat the Frog' Method", body: "Do your biggest, most dreaded task first thing in the morning. Once that's done, the rest of your day will feel much easier." },
                { title: "How to Sew a Button", body: "Use a double thread and make an 'X' pattern through the buttonholes. Loop the thread around the back a few times to create a shank, then tie it off securely." },
                { title: "How to Tie a Basic Knot (Square Knot)", body: "Right over left and under, then left over right and under. It's a simple, secure knot for tying ropes or packages." },
                { title: "How to Make a Simple Vinaigrette", body: "The classic ratio is 3 parts oil to 1 part vinegar. Add a pinch of salt, pepper, and a little mustard to help it emulsify (mix together)." },
                { title: "The Power of a 'Brain Dump'", body: "Feeling overwhelmed? Take 10 minutes to write down everything on your mind‚Äîtasks, worries, ideas. Getting it out of your head and onto paper makes it manageable." },
                { title: "How to Jump-Start a Car", body: "Connect positive to positive, then the other positive to its terminal. Connect the negative to the good battery's negative terminal, and the final negative clamp to a metal part of the dead car's engine block, away from the battery. Red to dead, red to good, black to good, black to ground." },
                { title: "How to Unclog a Sink", body: "First, try pouring a pot of boiling water down the drain. If that doesn't work, a mixture of baking soda and vinegar can often break up the clog." },
                { title: "How to Fold a Fitted Sheet", body: "Tuck the two top corners into the two bottom corners, creating a rectangle. Then fold it into a neat square. It takes practice!" },
                { title: "The 'See One, Do One, Teach One' Method", body: "A powerful way to learn. First, watch an expert. Then, do the task yourself. Finally, teach it to someone else to solidify your own understanding." },
                { title: "How to Change a Tire", body: "Loosen the lug nuts before you jack up the car. Once the car is raised, remove the nuts and the flat tire. Put on the spare, tighten the lug nuts by hand, lower the car, and then tighten them fully with the wrench." },
                { title: "Basic First Aid for a Cut", body: "Apply direct pressure with a clean cloth to stop the bleeding. Once it stops, gently clean the area with soap and water, apply an antibiotic ointment, and cover with a bandage." },
                { title: "The Importance of 'Mise en Place'", body: "A French cooking term for 'everything in its place.' Before you start cooking, get all your ingredients chopped, measured, and organized. It makes the actual cooking process smooth and stress-free." },
                { title: "How to Manage Your Email", body: "Use the 'touch it once' principle. When you open an email, decide immediately: delete it, delegate it, respond to it (if it takes <2 mins), or defer it (add it to your to-do list)." },
                { title: "The 'SMART' Goal Setting Method", body: "Make your goals Specific, Measurable, Achievable, Relevant, and Time-bound. Instead of 'get in shape,' try 'walk for 30 minutes, 3 times a week, for the next month.'" },
                { title: "How to Iron a Shirt", body: "Start with the collar, then the cuffs, then the sleeves, then the front panels, and finally the back. Use steam for stubborn wrinkles." },
                { title: "How to Be a Good Guest", body: "Always offer to help, respect the host's rules, engage in conversation, and never show up empty-handed (a small gift is always appreciated)." },
                { title: "The 'Pomodoro' Technique", body: "A time management method. Work in focused 25-minute intervals, separated by short 5-minute breaks. After four 'pomodoros,' take a longer break." },
                { title: "How to Whistle with Your Fingers", body: "Form a V-shape with your index and middle fingers. Wet your lips, place your fingertips under your tongue, and blow. It takes practice!" },
                { title: "How to Tell if a Fruit is Ripe", body: "It depends on the fruit! For many, like peaches and avocados, it should yield slightly to gentle pressure. For melons, it should sound hollow when tapped." },
                { title: "How to Make a Good Impression", body: "Smile, make eye contact, listen more than you talk, and ask thoughtful questions about the other person." },
                { title: "How to Use a Compass", body: "Hold the compass flat. The red end of the needle always points to magnetic north. Align the 'N' on the rotating bezel with the red needle to orient your map." },
                { title: "How to Perform the Heimlich Maneuver", body: "Stand behind the person, make a fist with one hand, place it thumb-side between their navel and ribcage, grasp your fist with your other hand, and give quick, upward thrusts." },
                { title: "How to Write a Simple 'To-Do' List That Works", body: "Don't just list tasks; prioritize them. Mark your top 3 most important tasks for the day and focus on completing those first." },
                { title: "How to Tell a Good Story", body: "A good story has a clear beginning, a middle with some kind of conflict or tension, and a satisfying end. Use descriptive words to paint a picture for your audience." },
                { title: "How to Give a Good Compliment", body: "Be specific and sincere. Instead of 'You look nice,' try 'That color looks fantastic on you, it really makes your eyes pop.' It shows you're paying attention." },
                { title: "How to Plant a Seed", body: "Plant the seed at a depth of about twice its diameter. Keep the soil moist but not waterlogged, and make sure it gets enough sunlight according to its needs." },
                { title: "How to Research a Topic Online", body: "Use multiple reliable sources (like academic sites, established news organizations, or museums) instead of just one. Be skeptical of information without an author or sources listed." },
                { title: "How to Be a Good Teammate", body: "Communicate clearly, do your share of the work without being asked, and celebrate your teammates' successes." },
                { title: "How to Create a Strong Password", body: "Use a mix of uppercase letters, lowercase letters, numbers, and symbols. A good trick is to use a memorable phrase and substitute some letters with numbers or symbols, like 'MyF@milyIs#1!'" },
                { title: "How to Introduce Two People", body: "Say the name of the person you want to honor first, then introduce the other person to them. For example, 'Grandma, I'd like you to meet my friend, Sarah. Sarah, this is my Grandma.'" },
                { title: "How to Pack a Suitcase Efficiently", body: "Roll your clothes instead of folding them to save space and prevent wrinkles. Place heavier items like shoes at the bottom near the wheels." },
                { title: "How to Ask for Help", body: "Be clear and direct about what you need. It's a sign of strength, not weakness, to know when you need support from others." },
                { title: "How to Listen to Your Body", body: "Pay attention to signals like thirst, hunger, and tiredness. Taking a short break, drinking water, or having a healthy snack can make a big difference in your day." },
                { title: "How to Apologize to a Group", body: "Address the group as a whole, take responsibility for your actions without making excuses, and state what you will do to make things right or prevent it from happening again." },
                { title: "How to Be a Gracious Winner and Loser", body: "When you win, be humble and thank your opponents for a good game. When you lose, congratulate the winner and focus on what you can learn for next time." },
                { title: "How to Start a Conversation", body: "Ask open-ended questions that can't be answered with 'yes' or 'no.' Instead of 'Are you having a good time?', try 'What's been the most interesting part of your day so far?'" },
                { title: "How to Take a Good Photo", body: "Pay attention to the light; outdoor photos are often best during the 'golden hour' right after sunrise or before sunset. Make sure your subject is in focus and think about what's in the background." },
                { title: "How to Be Patient", body: "When you feel impatient, take a few deep breaths. Try to understand the situation from the other person's perspective or focus on something else for a few moments." },
                { title: "How to Set a Table", body: "A simple rule: Forks go on the left, and knives and spoons go on the right. The knife blade should face the plate. Your water glass goes above the knife." }
            ]
        },
        friends: {
            title: "üéâ The Social Hub",
            labels: { dynamic: "üå∂Ô∏è Hot Takes", skill: "üç∏ Party Trick", checkin: "‚ö° Vibe Check" },
            btns: { dynamic: "Get Topic", skill: "Get Trick" },
            checkinList: [
                "<strong>üî• Fire:</strong> Best thing that happened recently.",
                "<strong>üßä Ice:</strong> Something boring or annoying.",
                "<strong>üöÄ Blast:</strong> Plans for the weekend."
            ],
            // EXTENDED FRIENDS LIBRARY
            iceBreakers: [
                "Worst date you've ever been on?", "What is a 'Red Flag' you ignore in dating?", 
                "If you won the lottery, what's the first thing you buy?", "Who here would die first in a zombie apocalypse?",
                "What is your go-to karaoke song?", "What is the weirdest thing you find attractive?",
                "If you could get away with a crime, what would it be?", "What was your most embarrassing moment in high school?",
                "If you could swap lives with one celebrity, who would it be?", "What is your guilty pleasure TV show?",
                "If you could punch one person in the face without consequences, who?", "What is the worst trend you ever followed?",
                "If you were an alcoholic drink, what would you be?", "What is your biggest pet peeve?",
                "If you could have dinner with three people (dead or alive), who?", "What is the best concert you have ever been to?",
                "What is the most expensive thing you have broken?", "Have you ever ghosted someone?",
                "What is a lie you tell often?", "What is the craziest thing you have done for love?"
            ],
            dynamics: [
                { title: "Debate:", body: "Is a hotdog a sandwich?" },
                { title: "Debate:", body: "Does pineapple belong on pizza?" },
                { title: "Debate:", body: "Is it better to text or call?" },
                { title: "Debate:", body: "Are leggings pants?" },
                { title: "Debate:", body: "Is water wet?" },
                { title: "Debate:", body: "Toilet paper: Over or Under?" },
                { title: "Debate:", body: "Is Die Hard a Christmas movie?" },
                { title: "Debate:", body: "Should you wash your legs in the shower?" },
                { title: "Debate:", body: "Is cereal soup?" },
                { title: "Debate:", body: "Is a taco a sandwich?" }
            ],
            skills: [
                { title: "Open a Bottle Without a Opener", body: "Use the edge of a lighter or a spoon as a lever under the cap." },
                { title: "The Perfect High Five", body: "Look at the other person's ELBOW, not their hand. You will never miss." },
                { title: "Saber a Champagne Bottle", body: "Find the seam of the bottle. Chill the neck. Slide a blunt knife along the seam and hit the lip firmly." },
                { title: "Remember Names", body: "Repeat their name immediately. 'Nice to meet you, Sarah.' Associate it with a visual image." },
                { title: "Exit a Boring Conversation", body: "Say 'I need to grab a drink/food/bathroom' or 'I see [Name], I need to say hi.'" },
                { title: "Remove Red Wine Stains", body: "Pour white wine or salt on the stain immediately to absorb it." },
                { title: "Whistle with Fingers", body: "Make an 'A' shape with index and middle fingers. Fold tongue back. Blow over the tongue." }
            ]
        },
        work: {
            title: "üíº Team Sync",
            labels: { dynamic: "üó£Ô∏è Discussion Topic", skill: "üöÄ Productivity Tip", checkin: "üö¶ Stand-Up" },
            btns: { dynamic: "New Topic", skill: "Get Tip" },
            checkinList: [
                "<strong>‚úÖ Done:</strong> What did you ship?",
                "<strong>üöß Doing:</strong> What is in progress?",
                "<strong>üõë Blocker:</strong> What is stopping you?"
            ],
            // EXTENDED WORK LIBRARY
            iceBreakers: [
                "What was your first job?", "What is one productivity tool you can't live without?", 
                "Coffee or Tea?", "Best career advice you ever received?", "What is your favorite way to decompress after work?",
                "If you could work from anywhere, where would it be?", "What is one skill you want to learn this year?",
                "What was the first thing you bought with your own money?", "Who is a mentor you admire?",
                "What is the best team you have ever been a part of?", "What is your preferred communication style?",
                "Morning lark or night owl?", "What is one book that changed your thinking?",
                "If you weren't in this career, what would you be doing?", "What is your favorite office snack?",
                "How do you handle stress?", "What is one thing you are proud of accomplishing this month?",
                "What is your desktop wallpaper?", "Do you prefer open office or private office?",
                "What is one thing you would change about our industry?"
            ],
            dynamics: [
                { title: "Process Check", body: "Is there a meeting we should cancel?" },
                { title: "Risk Assessment", body: "What is the biggest risk to our current deadline?" },
                { title: "Kudos", body: "Who deserves a shoutout this week?" },
                { title: "Retrospective", body: "What went well this sprint?" },
                { title: "Retrospective", body: "What didn't go well this sprint?" },
                { title: "Innovation", body: "What is one crazy idea we haven't tried?" },
                { title: "Customer Focus", body: "What is the biggest complaint we hear from customers?" },
                { title: "Culture", body: "How can we improve our team culture?" },
                { title: "Learning", body: "What is a mistake we made that we can learn from?" },
                { title: "Future", body: "Where do we want to be in 6 months?" }
            ],
            skills: [
                { title: "Box Breathing", body: "In for 4s, Hold for 4s, Out for 4s, Hold for 4s. Great for stress." },
                { title: "Inbox Zero", body: "Touch every email once. Delete, Delegate, Do (if <2mins), or Defer." },
                { title: "The Pomodoro Technique", body: "25 minutes of focus, 5 minutes of break. Repeat." },
                { title: "Time Blocking", body: "Schedule your day in blocks. Don't let your inbox dictate your schedule." },
                { title: "Saying No", body: "Politely decline tasks that don't align with your goals. 'I can't prioritize that right now.'" },
                { title: "Efficient Meetings", body: "No agenda, no meeting. Always end with clear action items." },
                { title: "Deep Work", body: "Eliminate distractions for 90 minutes to focus on hard problems." },
                { title: "The 80/20 Rule", body: "20% of your efforts produce 80% of your results. Focus on the 20%." },
                { title: "Feedback Sandwich", body: "Positive feedback, constructive criticism, positive feedback. (Use sparingly)." },
                { title: "Active Listening", body: "Listen to understand, not to reply." }
            ]
        }
    };

    // Shared Content (RESTORED FULL QUOTES LIBRARY)
    const sharedQuotes = [
        { text: "The only way to do great work is to love what you do.", author: "Steve Jobs" },
        { text: "The best time to plant a tree was 20 years ago. The second best time is now.", author: "Chinese Proverb" },
        { text: "Your time is limited, so don‚Äôt waste it living someone else‚Äôs life.", author: "Steve Jobs" },
        { text: "The future belongs to those who believe in the beauty of their dreams.", author: "Eleanor Roosevelt" },
        { text: "Strive not to be a success, but rather to be of value.", author: "Albert Einstein" },
        { text: "The journey of a thousand miles begins with a single step.", author: "Lao Tzu" },
        { text: "Family is not an important thing. It's everything.", author: "Michael J. Fox" },
        { text: "The love of a family is life's greatest blessing.", author: "Unknown" },
        { text: "In time of test, family is best.", author: "Burmese Proverb" },
        { text: "The strength of a family, like the strength of an army, is in its loyalty to each other.", author: "Mario Puzo" },
        { text: "The most important thing in the world is family and love.", author: "John Wooden" },
        { text: "To us, family means putting your arms around each other and being there.", author: "Barbara Bush" },
        { text: "Other things may change us, but we start and end with the family.", author: "Anthony Brandt" },
        { text: "The family is one of nature's masterpieces.", author: "George Santayana" },
        { text: "What can you do to promote world peace? Go home and love your family.", author: "Mother Teresa" },
        { text: "A happy family is but an earlier heaven.", author: "George Bernard Shaw" },
        { text: "Rejoice with your family in the beautiful land of life.", author: "Albert Einstein" },
        { text: "The memories we make with our family is everything.", author: "Candace Cameron Bure" },
        { text: "Family is the anchor that holds us through life's storms.", author: "Unknown" },
        { text: "Be kind, for everyone you meet is fighting a hard battle.", author: "Plato" },
        { text: "No act of kindness, no matter how small, is ever wasted.", author: "Aesop" },
        { text: "We can't help everyone, but everyone can help someone.", author: "Ronald Reagan" },
        { text: "The only thing that will redeem mankind is cooperation.", author: "Bertrand Russell" },
        { text: "Alone we can do so little; together we can do so much.", author: "Helen Keller" },
        { text: "If you want to lift yourself up, lift up someone else.", author: "Booker T. Washington" },
        { text: "The best way to find yourself is to lose yourself in the service of others.", author: "Mahatma Gandhi" },
        { text: "Success is not final, failure is not fatal: it is the courage to continue that counts.", author: "Winston Churchill" },
        { text: "It does not matter how slowly you go as long as you do not stop.", author: "Confucius" },
        { text: "Believe you can and you're halfway there.", author: "Theodore Roosevelt" },
        { text: "The secret of getting ahead is getting started.", author: "Mark Twain" },
        { text: "I have not failed. I've just found 10,000 ways that won't work.", author: "Thomas A. Edison" },
        { text: "The only impossible journey is the one you never begin.", author: "Tony Robbins" },
        { text: "Act as if what you do makes a difference. It does.", author: "William James" },
        { text: "Hardships often prepare ordinary people for an extraordinary destiny.", author: "C.S. Lewis" },
        { text: "It is our choices that show what we truly are, far more than our abilities.", author: "J.K. Rowling" },
        { text: "The measure of intelligence is the ability to change.", author: "Albert Einstein" },
        { text: "You must be the change you wish to see in the world.", author: "Mahatma Gandhi" },
        { text: "Where there is love there is life.", author: "Mahatma Gandhi" },
        { text: "Keep your face always toward the sunshine‚Äîand shadows will fall behind you.", author: "Walt Whitman" },
        { text: "The only source of knowledge is experience.", author: "Albert Einstein" },
        { text: "To live is the rarest thing in the world. Most people exist, that is all.", author: "Oscar Wilde" },
        { text: "It is never too late to be what you might have been.", author: "George Eliot" },
        { text: "For every minute you are angry you lose sixty seconds of happiness.", author: "Ralph Waldo Emerson" },
        { text: "If you want to be happy, be.", author: "Leo Tolstoy" },
        { text: "The purpose of our lives is to be happy.", author: "Dalai Lama" },
        { text: "Life is what happens when you're busy making other plans.", author: "John Lennon" },
        { text: "Get busy living or get busy dying.", author: "Stephen King" },
        { text: "You only live once, but if you do it right, once is enough.", author: "Mae West" },
        { text: "The two most important days in your life are the day you are born and the day you find out why.", author: "Mark Twain" },
        { text: "Everything you can imagine is real.", author: "Pablo Picasso" },
        { text: "Do what you can, with what you have, where you are.", author: "Theodore Roosevelt" },
        { text: "The best revenge is massive success.", author: "Frank Sinatra" }
    ];

    let currentMode = 'family';
    let usedIndices = { iceBreaker: [], dynamic: [], skill: [], quote: [] };

    // --- INIT ---
    window.onload = () => {
        const savedMode = localStorage.getItem('meetingMode');
        if(savedMode && db[savedMode]) {
            document.getElementById('modeSelect').value = savedMode;
        }
        changeMode();
    };

    // --- LOGIC ---
    function changeMode() {
        currentMode = document.getElementById('modeSelect').value;
        localStorage.setItem('meetingMode', currentMode);
        
        const d = db[currentMode];

        // Update Theme Attribute
        document.body.setAttribute('data-mode', currentMode);
        
        // Update Text
        document.getElementById('main-title').innerText = d.title;
        document.getElementById('lbl-dynamic').innerText = d.labels.dynamic;
        document.getElementById('lbl-skill').innerText = d.labels.skill;
        document.getElementById('lbl-checkin').innerText = d.labels.checkin;
        
        document.getElementById('btn-dynamic').innerText = d.btns.dynamic;
        document.getElementById('btn-skill').innerText = d.btns.skill;

        // Update Check-in List
        const list = document.getElementById('checkin-list');
        list.innerHTML = "";
        d.checkinList.forEach(item => {
            const li = document.createElement('li');
            li.innerHTML = item;
            list.appendChild(li);
        });

        // Reset Card Visuals
        document.querySelectorAll('.meeting-box').forEach(box => box.classList.remove('card-used'));
        
        // Clear Content Areas
        document.getElementById('dynamicContent').innerHTML = "<p>Ready?</p>";
        document.getElementById('skillContent').innerHTML = "<p>Ready?</p>";
        document.getElementById('iceBreakerContent').innerHTML = "<p>Ready?</p>";
        
        // Reset Used Tracking for new mode
        usedIndices = { iceBreaker: [], dynamic: [], skill: [], quote: [] };
    }

    function generate(type) {
        const d = db[currentMode];
        const box = document.getElementById(type === 'iceBreaker' ? 'iceBreakerContent' : type + 'Content');
        
        // Mark Card as Used
        if(box) box.closest('.meeting-box').classList.add('card-used');

        // Handle External APIs (Joke/Fact)
        if (type === 'joke') {
            box.innerHTML = "Loading...";
            fetch('https://official-joke-api.appspot.com/random_joke')
                .then(r => r.json())
                .then(data => box.innerHTML = `<p><strong>${data.setup}</strong><br><em>${data.punchline}</em></p>`)
                .catch(e => box.innerHTML = "<p>Why did the web developer leave? Because he didn't get a callback!</p>");
            return;
        }

        // Handle Internal Data
        let pool;
        if (type === 'quote') pool = sharedQuotes;
        else if (type === 'iceBreaker') pool = d.iceBreakers;
        else if (type === 'dynamic') pool = d.dynamics;
        else if (type === 'skill') pool = d.skills;

        if (!pool) return;

        // Random Selection with Repeat Prevention
        let index;
        let attempts = 0;
        do {
            index = Math.floor(Math.random() * pool.length);
            attempts++;
        } while (usedIndices[type] && usedIndices[type].includes(index) && attempts < 20);
        
        if (!usedIndices[type]) usedIndices[type] = [];
        usedIndices[type].push(index);

        const item = pool[index];

        // Render
        if (type === 'quote') {
            box.innerHTML = `<blockquote>"${item.text}"<br><small>- ${item.author}</small></blockquote>`;
        } else if (typeof item === 'string') {
            box.innerHTML = `<p>${item}</p>`;
        } else {
            box.innerHTML = `<h3>${item.title}</h3><p>${item.body}</p>`;
        }
    }

    function generateOrder() {
        const count = document.getElementById('participantCount').value;
        if (!count || count < 2) return alert("Enter at least 2 people.");
        let arr = [];
        for (let i = 1; i <= count; i++) arr.push(i);
        arr.sort(() => Math.random() - 0.5);
        document.getElementById('checkInOrder').innerText = "Order: Person " + arr.join(" ‚û° Person ");
    }

    function exportNotes() {
        const notes = document.getElementById('meetingNotes').value;
        if (!notes.trim()) return alert("No notes to export.");
        const blob = new Blob([notes], { type: 'text/plain;charset=utf-8' });
        const link = document.createElement('a');
        link.download = `Meeting-${new Date().toISOString().slice(0, 10)}.txt`;
        link.href = URL.createObjectURL(blob);
        link.click();
    }

    function toggleDarkTheme() {
        document.body.classList.toggle('dark-theme');
    }

    function closeModal(id) { document.getElementById(id).style.display = 'none'; }
    function showHelpModal() { document.getElementById('helpModal').style.display = 'block'; }
    function showRulesModal() { document.getElementById('rulesModal').style.display = 'block'; }
    window.onclick = function(e) { if(e.target.classList.contains('modal')) e.target.style.display = 'none'; }

</script>
</body>
</html>
