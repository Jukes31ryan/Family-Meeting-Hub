<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Lanturn</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,600;1,600&family=Nunito:wght@400;600&display=swap" rel="stylesheet">
<style>
/* THEME: ENCHANTED MOONLIT FOREST */
*, *::before, *::after { margin:0; padding:0; box-sizing:border-box; }
html, body {
  height:100%; width:100%; overflow:hidden;
  font-family:'Nunito', sans-serif;
  -webkit-font-smoothing:antialiased;
  -webkit-tap-highlight-color:transparent;
  touch-action:manipulation;
  color:#E0F7FA;
}

/* DEEP SPACE TEAL GRADIENT */
.bg-layer {
  position:fixed; inset:0;
  transition:opacity 1.2s ease;
  background: linear-gradient(180deg, #011219 0%, #042330 40%, #0a3d4d 100%);
}

/* INTENSE MOON GLOW */
.moon {
  position:fixed;
  top:40px; right:50%; transform:translateX(50%);
  width:120px; height:120px;
  border-radius:50%;
  background: radial-gradient(circle at 40% 40%, #FFFFFF 10%, #E0F7FA 50%, #80DEEA 90%);
  box-shadow: 
    0 0 50px rgba(128, 222, 234, 0.9),   
    0 0 120px rgba(128, 222, 234, 0.6),  
    0 0 300px rgba(128, 222, 234, 0.3);
  z-index:5;
}

/* HORIZON SILHOUETTE */
.silhouette {
  position:fixed;
  bottom:140px; left:0; right:0; height:150px;
  background: linear-gradient(to top, #010a12 20%, transparent 100%);
  z-index: 3;
  pointer-events: none;
}

/* MIST FOG */
.mist {
  position:fixed;
  bottom:100px; left:-20%; right:-20%; height:120px;
  background: radial-gradient(ellipse at bottom, rgba(178,235,242,0.2) 0%, transparent 70%);
  filter: blur(30px);
  z-index: 4;
  opacity: 0.6;
  animation: mistDrift 60s linear infinite alternate;
  pointer-events: none;
}
@keyframes mistDrift { from { transform: translateX(0); } to { transform: translateX(40px); } }

/* RIVER REFLECTION */
.river {
  position:fixed;
  bottom:0; left:0; right:0;
  height:160px;
  background: linear-gradient(180deg, rgba(4, 35, 48, 0.6) 0%, rgba(178,235,242,0.1) 40%, rgba(178,235,242,0.2) 100%);
  z-index:4;
  pointer-events: none;
}
.river::before {
  content:''; position:absolute;
  top:0px; left:50%; transform:translateX(-50%);
  width:200px; height:160px;
  background: radial-gradient(ellipse at top, rgba(255,255,255,0.5) 0%, rgba(128,222,234,0.3) 30%, transparent 80%);
  filter: blur(20px); opacity:0.7;
}

/* FIREFLIES */
#fireflies { position:fixed; inset:0; z-index:6; pointer-events:none; }
.firefly {
  position:absolute; border-radius:50%;
  animation: fireflyFloat linear infinite;
}
@keyframes fireflyFloat {
  0% { transform:translate(0, 0) scale(1); opacity:0; }
  20% { opacity:0.9; }
  100% { transform:translate(30px, -80px) scale(0.2); opacity:0; }
}

/* LAYOUT */
.screen {
  position:fixed; inset:0; z-index:10;
  display:flex; flex-direction:column;
  align-items:center; justify-content:center;
  padding:80px 24px 60px;
  opacity:0; pointer-events:none;
  transition:opacity 0.6s ease;
  overflow-y:auto;
}
.screen.active { opacity:1; pointer-events:auto; }

.anim-in {
  opacity:0; transform:translateY(15px);
  transition:opacity 0.7s ease, transform 0.7s ease;
}
.screen.active .anim-in { opacity:1; transform:translateY(0); }
.screen.active .anim-in:nth-child(1) { transition-delay:0.1s; }
.screen.active .anim-in:nth-child(2) { transition-delay:0.2s; }
.screen.active .anim-in:nth-child(3) { transition-delay:0.3s; }
.screen.active .anim-in:nth-child(4) { transition-delay:0.4s; }

/* CHROME (Back/Home) */
#top-chrome {
  position:fixed; top:0; left:0; right:0; z-index:100;
  display:flex; align-items:center; justify-content:space-between;
  padding:24px;
  opacity:0; pointer-events:none;
  transition:opacity 0.3s ease;
}
#top-chrome.visible { opacity:1; pointer-events:auto; }

.nav-btn {
  background:none; border:none;
  color:rgba(224,247,250,0.6); font-size:1.2rem; cursor:pointer;
}
.nav-btn:hover { color:#fff; }

.dots { display:flex; gap:8px; }
.dot {
  width:6px; height:6px; border-radius:50%;
  background:rgba(224,247,250,0.2); transition:all 0.3s;
}
.dot.active { background:#80DEEA; transform:scale(1.2); box-shadow:0 0 8px #80DEEA; }
.dot.done { background:rgba(128,222,234,0.4); }

/* HOME SCREEN */
#screen-home { justify-content: flex-end; padding-bottom: 120px; }
.lantern-logo {
  font-size:4rem; 
  filter:drop-shadow(0 0 25px rgba(128,222,234,0.8));
  animation: floatLogo 4s ease-in-out infinite; margin-bottom:20px;
}
@keyframes floatLogo { 0%, 100% { transform:translateY(0); } 50% { transform:translateY(-10px); } }

.title-main {
  font-family:'Cormorant Garamond', serif; font-size:3.8rem; font-weight:600;
  letter-spacing:0.02em; color:#fff;
  text-shadow:0 2px 30px rgba(0,0,0,0.5), 0 0 30px rgba(128,222,234,0.4);
  margin-bottom: 5px;
}
.title-sub {
  font-size:1.2rem; color:rgba(224,247,250,0.8); font-weight:400; margin-bottom:45px;
  text-shadow:0 1px 10px rgba(0,0,0,0.5);
}

/* CRYSTALLINE BUTTON */
.btn-start, .btn-continue {
  padding:18px 50px; border-radius:50px;
  background: linear-gradient(135deg, rgba(128,222,234,0.2), rgba(77,208,225,0.3));
  border:1px solid rgba(128,222,234,0.5);
  backdrop-filter:blur(10px);
  color:#fff; font-family:'Cormorant Garamond', serif;
  font-size:1.4rem; font-weight:600; letter-spacing:0.05em;
  cursor:pointer; transition:all 0.3s ease;
  box-shadow:0 0 30px rgba(128,222,234,0.2);
}
.btn-start:hover, .btn-continue:hover {
  background: linear-gradient(135deg, rgba(128,222,234,0.3), rgba(77,208,225,0.5));
  box-shadow:0 0 50px rgba(128,222,234,0.5); transform:scale(1.02) translateY(-2px);
}
.btn-continue {
  position:fixed; bottom:40px; font-family:'Nunito', sans-serif; font-size:1rem; padding:16px 40px; z-index:20;
}

/* TEXT STYLES */
.label-top {
  font-size:0.8rem; text-transform:uppercase; letter-spacing:0.15em;
  color:#80DEEA; margin-bottom:20px; font-weight:700; opacity:0.8;
}
.card-text-lg {
  font-family:'Cormorant Garamond', serif; font-size:2rem; line-height:1.3;
  text-align:center; color:#fff; margin-bottom:10px;
  text-shadow: 0 2px 10px rgba(0,0,0,0.3);
}
.card-text-md {
  font-size:1.1rem; line-height:1.6; text-align:center;
  color:rgba(224,247,250,0.9); max-width:600px;
}

/* CARD-SPECIFIC ALIGNMENT */
.text-left { text-align: left; }
.story-scroll {
  max-height:40vh; overflow-y:auto; padding-right:10px; margin-bottom:20px; text-align:left;
  scrollbar-width: thin; scrollbar-color: rgba(128,222,234,0.3) transparent;
}
.story-scroll::-webkit-scrollbar { width:4px; }
.story-scroll::-webkit-scrollbar-thumb { background:rgba(128,222,234,0.3); border-radius:4px; }

.moral-box {
  background:rgba(128,222,234,0.1); border-left:2px solid #80DEEA;
  padding:15px; border-radius:0 8px 8px 0; margin-top:20px; font-style:italic; color:#E0F7FA;
}

.cheat-code-box {
  background:rgba(128,222,234,0.1); border-left:4px solid #80DEEA;
  padding:15px; margin-top:15px; border-radius:0 8px 8px 0; font-weight:500; font-size:0.95rem; text-align:left;
}

/* SECONDARY BUTTONS (Refresh / Heart) */
.btn-icon-group { display:flex; gap:12px; margin-top:30px; }
.btn-icon {
  width:44px; height:44px; border-radius:50%;
  background:rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.2);
  color:rgba(255,255,255,0.7); font-size:1.2rem; cursor:pointer;
  display:flex; align-items:center; justify-content:center; transition:all 0.2s ease;
}
.btn-icon:hover { background:rgba(255,255,255,0.15); color:#fff; box-shadow: 0 0 15px rgba(128,222,234,0.3); }
.btn-icon.saved {
  background:rgba(255,100,100,0.2); border-color:rgba(255,100,100,0.5); color:#ff6b6b;
  animation: heartPop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}
@keyframes heartPop { 0% { transform:scale(1); } 50% { transform:scale(1.3); } 100% { transform:scale(1); } }

/* REVEAL BUTTON (Joke) */
.btn-reveal {
  background:rgba(128,222,234,0.1); border:1px solid rgba(128,222,234,0.3);
  color:#fff; padding:10px 24px; border-radius:20px;
  cursor:pointer; margin-top:20px; font-family:'Cormorant Garamond', serif; font-size:1.1rem;
}
</style>
</head>
<body>

<div class="bg-layer" id="bg-a"></div>
<div class="moon"></div>
<div class="silhouette"></div>
<div class="mist"></div>
<div class="river"></div>
<div id="fireflies"></div>

<div id="top-chrome">
  <button class="nav-btn" onclick="goBack()">‚Üê</button>
  <div class="dots" id="dots-container"></div>
  <button class="nav-btn" onclick="goHome()">‚úï</button>
</div>

<div class="screen active" id="screen-home">
  <div class="lantern-logo anim-in">üèÆ</div>
  <div class="title-main anim-in">Lanturn</div>
  <div class="title-sub anim-in">A brighter way to check in</div>
  <button class="btn-start anim-in" onclick="startSession()">Begin</button>
</div>

<div class="screen" id="screen-icebreaker">
  <div class="label-top anim-in">Ice Breaker</div>
  <div class="card-text-lg anim-in" id="ib-text">Loading...</div>
  <div class="btn-icon-group anim-in">
    <button class="btn-icon" onclick="oneMore('icebreaker')">‚Üª</button>
    <button class="btn-icon" onclick="toggleSave(this)">‚ô°</button>
  </div>
  <button class="btn-continue" onclick="goToAct(2)">Continue</button>
</div>

<div class="screen" id="screen-quote">
  <div class="label-top anim-in">Perspective</div>
  <div style="font-size:4rem; line-height:0.5; color:#80DEEA; opacity:0.5; margin-bottom:20px;" class="anim-in">"</div>
  <div class="card-text-lg anim-in" style="font-style:italic;" id="qt-text"></div>
  <div class="anim-in" style="margin-top:20px; color:#80DEEA; font-weight:600;" id="qt-author"></div>
  <div class="btn-icon-group anim-in">
    <button class="btn-icon" onclick="oneMore('quote')">‚Üª</button>
    <button class="btn-icon" onclick="toggleSave(this)">‚ô°</button>
  </div>
  <button class="btn-continue" onclick="goToAct(3)">Continue</button>
</div>

<div class="screen" id="screen-checkin">
  <div class="label-top anim-in">Check In</div>
  <div class="anim-in" style="background:rgba(4, 35, 48, 0.5); padding:20px; border-radius:12px; width:100%; max-width:400px; margin-bottom:10px; border-left:3px solid #80DEEA;">
    <div style="font-size:0.8rem; color:#80DEEA; margin-bottom:5px;">GRATITUDE</div>
    <div style="font-size:1.1rem;" id="ci-grat"></div>
  </div>
  <div class="anim-in" style="background:rgba(4, 35, 48, 0.5); padding:20px; border-radius:12px; width:100%; max-width:400px; border-left:3px solid #C4B7EB;">
    <div style="font-size:0.8rem; color:#C4B7EB; margin-bottom:5px;">INTENTION</div>
    <div style="font-size:1.1rem;" id="ci-goal"></div>
  </div>
  <div class="btn-icon-group anim-in">
    <button class="btn-icon" onclick="oneMore('checkin')">‚Üª</button>
  </div>
  <button class="btn-continue" onclick="goToAct(4)">Continue</button>
</div>

<div class="screen" id="screen-story">
  <div class="label-top anim-in">Story</div>
  <div class="card-text-lg anim-in" style="font-size:1.8rem; margin-bottom:20px;" id="story-title"></div>
  <div class="story-scroll anim-in">
    <div id="story-body" style="font-size:1.1rem; line-height:1.7; color:rgba(224,247,250,0.9);"></div>
    </div>
  <div class="btn-icon-group anim-in">
    <button class="btn-icon" onclick="oneMore('story')">‚Üª</button>
    <button class="btn-icon" onclick="toggleSave(this)">‚ô°</button>
  </div>
  <button class="btn-continue" onclick="goToAct(5)">Continue</button>
</div>

<div class="screen" id="screen-lesson">
  <div class="label-top anim-in">Skill</div>
  <div class="card-text-lg anim-in" style="font-size:1.6rem;" id="les-title"></div>
  <div class="card-text-md anim-in text-left" style="margin-top:15px;" id="les-body"></div>
  <div class="btn-icon-group anim-in">
    <button class="btn-icon" onclick="oneMore('lesson')">‚Üª</button>
    <button class="btn-icon" onclick="toggleSave(this)">‚ô°</button>
  </div>
  <button class="btn-continue" onclick="goToAct(6)">Continue</button>
</div>

<div class="screen" id="screen-mindful">
  <div class="label-top anim-in">Breathe</div>
  <div class="card-text-md anim-in">Take 30 seconds. Close your eyes. Just be here.</div>
  <div class="anim-in" style="font-family:'Cormorant Garamond'; font-size:5rem; margin:30px 0; font-variant-numeric:tabular-nums; text-shadow:0 0 20px rgba(128,222,234,0.5);" id="mindful-timer">0:30</div>
  <button class="btn-reveal anim-in" id="btn-mindful" onclick="startMindful()">Start Timer</button>
  <button class="btn-continue" style="display:none;" id="mindful-cont" onclick="goToAct(7)">Continue</button>
</div>

<div class="screen" id="screen-joke">
  <div class="label-top anim-in">Smile</div>
  <div class="card-text-lg anim-in" id="jk-setup"></div>
  <button class="btn-reveal anim-in" id="btn-reveal" onclick="revealJoke()">Reveal</button>
  <div id="pk-wrap" style="display:none; margin-top:30px; flex-direction:column; align-items:center;">
    <div style="width:50px; height:2px; background:#fff; opacity:0.3; margin-bottom:20px;"></div>
    <div class="card-text-lg" style="color:#80DEEA;" id="jk-punch"></div>
  </div>
  <div class="btn-icon-group anim-in" style="margin-top:40px;">
    <button class="btn-icon" onclick="oneMore('joke')">‚Üª</button>
  </div>
  <button class="btn-continue" onclick="goToAct(8)">Finish</button>
</div>

<div class="screen" id="screen-close">
  <div class="lantern-logo anim-in">üèÆ</div>
  <div class="card-text-lg anim-in">Session Complete</div>
  <div class="card-text-md anim-in">You took time to connect today.<br>That matters.</div>
  <button class="btn-start anim-in" style="margin-top:40px;" onclick="goHome()">Home</button>
</div>

<script src="data.js"></script>
<script>
// Logic to handle Data + UI
let S = { act: 0 };
let mindfulInterval = null;

// FIREFLIES GENERATOR (Enchanted & Varied)
(function() {
  const c = document.getElementById('fireflies');
  // Colors: Warm Yellow, Magic Cyan, Soft White, Pale Green
  const colors = ['#FFF9C4', '#80DEEA', '#FFFFFF', '#C8E6C9']; 
  for(let i=0; i<30; i++){
    let d = document.createElement('div');
    d.className='firefly';
    d.style.left = Math.random()*100 + '%';
    d.style.top = Math.random()*100 + '%';
    // Randomize movement duration
    d.style.animationDuration = (Math.random()*15 + 10) + 's'; 
    d.style.animationDelay = (Math.random()*5) + 's';
    // Randomize size
    let size = Math.random()*4 + 2;
    d.style.width = size + 'px';
    d.style.height = size + 'px';
    // Randomize color
    let color = colors[Math.floor(Math.random() * colors.length)];
    d.style.background = color;
    d.style.boxShadow = `0 0 ${size*2}px ${color}`;
    d.style.opacity = Math.random() * 0.7 + 0.3;
    c.appendChild(d);
  }
})();

function pick(arr) { 
    if(!arr || arr.length === 0) return "Loading...";
    return arr[Math.floor(Math.random() * arr.length)]; 
}

function toggleSave(btn) {
  btn.classList.toggle('saved');
  btn.innerHTML = btn.classList.contains('saved') ? '‚ô•' : '‚ô°';
}

function show(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  setTimeout(() => document.getElementById(id).classList.add('active'), 50);
}

function updateDots(n) {
  const c = document.getElementById('dots-container');
  c.innerHTML = '';
  for(let i=1; i<=8; i++) {
    let d = document.createElement('div');
    d.className = 'dot ' + (i===n ? 'active' : (i<n ? 'done' : ''));
    c.appendChild(d);
  }
}

function goHome() {
  S.act = 0;
  document.getElementById('top-chrome').classList.remove('visible');
  document.querySelector('.btn-continue').style.display = 'none';
  show('screen-home');
}

function goBack() {
  if(S.act <= 1) goHome();
  else goToAct(S.act - 1);
}

function goToAct(n) {
  S.act = n;
  const screens = ['home','icebreaker','quote','checkin','story','lesson','mindful','joke','close'];
  
  if(n===0) { goHome(); return; }
  
  document.getElementById('top-chrome').classList.add('visible');
  updateDots(n);
  show('screen-' + screens[n]);
  
  const btn = document.querySelector('.btn-continue');
  btn.style.display = (n === 7 || n === 9) ? 'none' : 'block';

  if(n===1) loadIB();
  if(n===2) loadQT();
  if(n===3) loadCI();
  if(n===4) loadST();
  if(n===5) loadLS();
  if(n===6) loadMF();
  if(n===7) loadJK();
}

function startSession() { goToAct(1); }

function oneMore(type) {
  if(type==='icebreaker') loadIB();
  if(type==='quote') loadQT();
  if(type==='checkin') loadCI();
  if(type==='story') loadST();
  if(type==='lesson') loadLS();
  if(type==='joke') loadJK();
  
  document.querySelectorAll('.btn-icon.saved').forEach(b => {
    b.classList.remove('saved');
    b.innerHTML = '‚ô°';
  });
}

// Single Mode: Hard-coded to 'dinner' key in data.js
function loadIB() { document.getElementById('ib-text').innerText = pick(db.dinner.iceBreakers); }
function loadQT() { 
  let q = pick(db.dinner.quotes);
  document.getElementById('qt-text').innerText = q.text;
  document.getElementById('qt-author').innerText = "- " + q.author;
}
function loadCI() {
  // Randomly picking one prompt from checkin array or just static instructions? 
  // Let's use the provided static checkins for structure but randomized prompts for variety would be better.
  // For now, let's grab random items from the checkin array if it exists, or specific prompts.
  // Actually, data.js has specific prompts. Let's make it dynamic.
  // Wait, data.js checkin is an array of 3 specific strings. Let's just use them all or pick 2 randoms.
  // The UI has slots for 'Gratitude' and 'Intention'. I'll mock up random selection.
  const gratitudePrompts = ["What made you smile today?", "Who helped you recently?", "What is a simple pleasure you enjoyed?"];
  const intentionPrompts = ["What is one goal for tomorrow?", "How can you be kind this week?", "What do you want to improve?"];
  
  document.getElementById('ci-grat').innerText = pick(gratitudePrompts);
  document.getElementById('ci-goal').innerText = pick(intentionPrompts);
}
function loadST() {
  let s = pick(db.dinner.dynamics);
  document.getElementById('story-title').innerText = s.title;
  document.getElementById('story-body').innerHTML = s.body; // InnerHTML to allow bolding/cheat codes
}
function loadLS() {
  let l = pick(db.dinner.skills);
  document.getElementById('les-title').innerText = l.title;
  document.getElementById('les-body').innerText = l.body;
}
function loadMF() {
  document.getElementById('mindful-timer').innerText = "0:30";
  document.getElementById('btn-mindful').style.display = "block";
  document.getElementById('mindful-cont').style.display = "none";
}
function startMindful() {
  document.getElementById('btn-mindful').style.display = "none";
  let t = 30;
  mindfulInterval = setInterval(() => {
    t--;
    document.getElementById('mindful-timer').innerText = "0:" + (t<10?"0":"") + t;
    if(t<=0) {
      clearInterval(mindfulInterval);
      document.getElementById('mindful-cont').style.display = "block";
    }
  }, 1000);
}
function loadJK() {
  // Fetch joke from API or fallback to DB if API fails
  fetch('https://official-joke-api.appspot.com/random_joke')
    .then(r => r.json())
    .then(data => {
        document.getElementById('jk-setup').innerText = data.setup;
        document.getElementById('jk-punch').innerText = data.punchline;
    })
    .catch(() => {
        // Fallback
        document.getElementById('jk-setup').innerText = "Why did the developer go broke?";
        document.getElementById('jk-punch').innerText = "He used up all his cache.";
    });

  document.getElementById('btn-reveal').style.display = "block";
  document.getElementById('pk-wrap').style.display = "none";
  document.querySelector('.btn-continue').style.display = "none";
}
function revealJoke() {
  document.getElementById('btn-reveal').style.display = "none";
  document.getElementById('pk-wrap').style.display = "flex";
  document.querySelector('.btn-continue').style.display = "block";
}
</script>
</body>
</html>
